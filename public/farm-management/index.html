<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Farm Management - Sheep Land</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Kufi+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="style.css">
    <style>[x-cloak]{display:none!important}</style>
    <script src="../vendor/pocketbase.umd.js"></script>
</head>
<body x-data="farmManagement" x-init="init()" x-cloak>
    <div class="management-container">
        <header class="management-header">
            <div class="header-content">
                <h1 class="bil-spread">
                    <span class="en">Farm Management System</span>
                    <span class="ar">ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≤ÿ±ÿπÿ©</span>
                </h1>
                <div class="header-actions">
                    <button @click="showAddSheep = true" class="btn bp bil-inline">
                        <span class="en">+ Add Sheep</span>
                        <span class="ar">+ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ£ÿ≥</span>
                    </button>
                    <a href="../index.html" class="btn bp-alt bil-inline">
                        <span class="en">‚Üê Back to Shop</span>
                        <span class="ar">‚Üê ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖÿ™ÿ¨ÿ±</span>
                    </a>
                </div>
            </div>
        </header>

        <main class="management-main">
            <!-- Stats Overview -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üêë</div>
                    <div class="stat-content">
                        <h3 class="bil-inline">
                            <span class="en">Total Sheep</span>
                            <span class="ar">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ∫ŸÜÿßŸÖ</span>
                        </h3>
                        <p class="stat-value" x-text="stats.totalSheep">0</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üíö</div>
                    <div class="stat-content">
                        <h3 class="bil-inline">
                            <span class="en">Healthy</span>
                            <span class="ar">ÿ®ÿµÿ≠ÿ© ÿ¨ŸäÿØÿ©</span>
                        </h3>
                        <p class="stat-value" x-text="stats.healthy">0</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ü§∞</div>
                    <div class="stat-content">
                        <h3 class="bil-inline">
                            <span class="en">Pregnant</span>
                            <span class="ar">ÿ≠ÿßŸÖŸÑ</span>
                        </h3>
                        <p class="stat-value" x-text="stats.pregnant">0</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-content">
                        <h3 class="bil-inline">
                            <span class="en">Need Attention</span>
                            <span class="ar">ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ±ÿπÿßŸäÿ©</span>
                        </h3>
                        <p class="stat-value" x-text="stats.needAttention">0</p>
                    </div>
                </div>
            </div>

            <!-- Sheep List -->
            <div class="sheep-section">
                <div class="section-header">
                    <h2 class="bil-spread">
                        <span class="en">Sheep Inventory</span>
                        <span class="ar">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ∫ŸÜÿßŸÖ</span>
                    </h2>
                    <div class="filter-controls">
                        <select x-model="filterStatus" @change="filterSheep()" class="filter-select">
                            <option value="">All Status</option>
                            <option value="healthy">Healthy</option>
                            <option value="sick">Sick</option>
                            <option value="pregnant">Pregnant</option>
                        </select>
                    </div>
                </div>

                <div class="sheep-grid">
                    <template x-for="sheep in filteredSheep" :key="sheep.id">
                        <div class="sheep-card" :class="'status-' + sheep.status">
                            <div class="sheep-header">
                                <h3 x-text="sheep.tagId"></h3>
                                <span class="sheep-status" x-text="sheep.status"></span>
                            </div>
                            <div class="sheep-details">
                                <p class="detail-row">
                                    <span class="bil-inline">
                                        <span class="en">Breed:</span>
                                        <span class="ar">ÿßŸÑÿ≥ŸÑÿßŸÑÿ©:</span>
                                    </span>
                                    <span x-text="sheep.breed"></span>
                                </p>
                                <p class="detail-row">
                                    <span class="bil-inline">
                                        <span class="en">Age:</span>
                                        <span class="ar">ÿßŸÑÿπŸÖÿ±:</span>
                                    </span>
                                    <span x-text="sheep.age + ' months'"></span>
                                </p>
                                <p class="detail-row">
                                    <span class="bil-inline">
                                        <span class="en">Weight:</span>
                                        <span class="ar">ÿßŸÑŸàÿ≤ŸÜ:</span>
                                    </span>
                                    <span x-text="sheep.weight + ' kg'"></span>
                                </p>
                                <p class="detail-row" x-show="sheep.lastVaccination">
                                    <span class="bil-inline">
                                        <span class="en">Last Vaccination:</span>
                                        <span class="ar">ÿ¢ÿÆÿ± ÿ™ÿ∑ÿπŸäŸÖ:</span>
                                    </span>
                                    <span x-text="formatDate(sheep.lastVaccination)"></span>
                                </p>
                            </div>
                            <div class="sheep-actions">
                                <button @click="editSheep(sheep)" class="btn btn-sm bac bil-inline">
                                    <span class="en">Edit</span>
                                    <span class="ar">ÿ™ÿπÿØŸäŸÑ</span>
                                </button>
                                <button @click="recordHealth(sheep)" class="btn btn-sm bp-alt bil-inline">
                                    <span class="en">Health</span>
                                    <span class="ar">ÿßŸÑÿµÿ≠ÿ©</span>
                                </button>
                                <button @click="deleteSheep(sheep.id)" class="btn btn-sm danger bil-inline">
                                    <span class="en">Delete</span>
                                    <span class="ar">ÿ≠ÿ∞ŸÅ</span>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>

                <div x-show="filteredSheep.length === 0" class="empty-state">
                    <p class="bil-spread">
                        <span class="en">No sheep found</span>
                        <span class="ar">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ∫ŸÜÿßŸÖ</span>
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Sheep Modal -->
    <div x-show="showAddSheep" class="modal-overlay" @click.self="showAddSheep = false">
        <div class="modal">
            <div class="modal-header">
                <h2 class="bil-spread">
                    <span class="en" x-text="editingId ? 'Edit Sheep' : 'Add New Sheep'"></span>
                    <span class="ar" x-text="editingId ? 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™' : 'ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ£ÿ≥ ÿ¨ÿØŸäÿØ'"></span>
                </h2>
                <button @click="showAddSheep = false" class="modal-close">√ó</button>
            </div>
            <form @submit.prevent="saveSheep()" class="modal-content">
                <div class="form-group">
                    <label class="bil-spread">
                        <span class="en">Tag ID</span>
                        <span class="ar">ÿ±ŸÇŸÖ ÿßŸÑÿπŸÑÿßŸÖÿ©</span>
                    </label>
                    <input type="text" x-model="sheepForm.tagId" required class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="bil-spread">
                        <span class="en">Breed</span>
                        <span class="ar">ÿßŸÑÿ≥ŸÑÿßŸÑÿ©</span>
                    </label>
                    <select x-model="sheepForm.breed" required class="form-input">
                        <option value="">Select Breed</option>
                        <option value="Barki">Barki / ÿ®ÿ±ŸÇŸä</option>
                        <option value="Rahmani">Rahmani / ÿ±ÿ≠ŸÖÿßŸÜŸä</option>
                        <option value="Ossimi">Ossimi / ÿ£Ÿàÿ≥ŸäŸÖŸä</option>
                        <option value="Saidi">Saidi / ÿµÿπŸäÿØŸä</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="bil-spread">
                            <span class="en">Age (months)</span>
                            <span class="ar">ÿßŸÑÿπŸÖÿ± (ÿ¥ŸáŸàÿ±)</span>
                        </label>
                        <input type="number" x-model="sheepForm.age" min="0" required class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="bil-spread">
                            <span class="en">Weight (kg)</span>
                            <span class="ar">ÿßŸÑŸàÿ≤ŸÜ (ŸÉÿ¨ŸÖ)</span>
                        </label>
                        <input type="number" x-model="sheepForm.weight" min="0" step="0.1" required class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="bil-spread">
                        <span class="en">Status</span>
                        <span class="ar">ÿßŸÑÿ≠ÿßŸÑÿ©</span>
                    </label>
                    <select x-model="sheepForm.status" required class="form-input">
                        <option value="healthy">Healthy / ÿ®ÿµÿ≠ÿ© ÿ¨ŸäÿØÿ©</option>
                        <option value="sick">Sick / ŸÖÿ±Ÿäÿ∂</option>
                        <option value="pregnant">Pregnant / ÿ≠ÿßŸÖŸÑ</option>
                        <option value="nursing">Nursing / ŸÖÿ±ÿ∂ÿπ</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" @click="showAddSheep = false" class="btn bp-alt bil-inline">
                        <span class="en">Cancel</span>
                        <span class="ar">ÿ•ŸÑÿ∫ÿßÿ°</span>
                    </button>
                    <button type="submit" class="btn bp bil-inline">
                        <span class="en" x-text="editingId ? 'Update' : 'Add'"></span>
                        <span class="ar" x-text="editingId ? 'ÿ™ÿ≠ÿØŸäÿ´' : 'ÿ•ÿ∂ÿßŸÅÿ©'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading and error indicators -->
    <div x-show="loading" class="load-ind" x-cloak>
        <span x-text="loadingMessage || 'Loading...'"></span>
    </div>
    
    <div x-show="error" class="err-ind" x-cloak>
        <span x-text="error"></span>
    </div>

    <!-- Auth check modal -->
    <div x-show="!isAuthenticated" class="modal-overlay" x-cloak>
        <div class="auth-modal">
            <h2 class="bil-spread">
                <span class="en">Admin Access Required</span>
                <span class="ar">ŸÖÿ∑ŸÑŸàÿ® ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±ŸÅ</span>
            </h2>
            <p class="bil-spread">
                <span class="en">Please login as admin to access this tool</span>
                <span class="ar">Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉŸÖÿ¥ÿ±ŸÅ ŸÑŸÑŸàÿµŸàŸÑ ŸÑŸáÿ∞Ÿá ÿßŸÑÿ£ÿØÿßÿ©</span>
            </p>
            <a href="../index.html" class="btn bp bil-inline">
                <span class="en">Go to Login</span>
                <span class="ar">ÿßŸÑÿ∞Ÿáÿßÿ® ŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</span>
            </a>
        </div>
    </div>

    <script src="../vendor/alpine.min.js" defer></script>
    <script src="script.js"></script>
</body>
</html>