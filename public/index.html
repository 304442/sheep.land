<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="Order premium, Sharia-compliant Udheya, Livestock, and Meats online with Sheep Land. Experience quality, convenience, and tradition.">
    <title x-text="pageTitle() + ' - Sheep Land'">Sheep Land</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,500;0,600;0,700&family=Noto+Kufi+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <style>[x-cloak]{display:none!important}</style>
</head>
<body x-data="udh" x-init="initApp()" x-cloak :class="{'no-scroll': isCartOpen || isRefundModalOpen || isOrderStatusModalOpen || isUdheyaConfigModalOpen}">

<!-- Loading State -->
<div x-show="load.init && !apiErr" class="loading" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:100;background:var(--bg);padding:var(--space-xl);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg)" aria-live="polite">
    <div class="spinner"></div>
    <span>Loading application data...</span>
</div>

<!-- Error State -->
<div x-show="apiErr" class="alert alert-error" style="position:fixed;top:var(--space);left:50%;transform:translateX(-50%);z-index:100;max-width:500px" role="alert" aria-live="assertive">
    <span x-text="usrApiErr || 'An unexpected error occurred. Please try again.'"></span>
</div>

<!-- Cart Sidebar -->
<div x-show="isCartOpen" class="cart-overlay" @click="closeCart()" x-transition:enter="fade-enter" x-transition:enter-active="fade-enter-active" x-transition:leave="fade-leave" x-transition:leave-active="fade-leave-active"></div>
<aside x-show="isCartOpen" class="cart-sidebar" x-transition:enter="slide-enter" x-transition:enter-active="slide-enter-active" x-transition:leave="slide-leave" x-transition:leave-active="slide-leave-active" role="dialog" aria-modal="true" aria-labelledby="cart-title">
    <div class="cart-header">
        <h2 id="cart-title" class="cart-title bilingual">
            <span class="en">Your Cart</span><span class="ar">ุณูุชู</span>
        </h2>
        <button @click="closeCart()" class="close-btn" aria-label="Close cart">ร</button>
    </div>
    
    <div class="cart-content">
        <div x-show="cartItems.length === 0" class="cart-empty">
            <div class="bilingual-center">
                <p class="en">Your cart is currently empty</p>
                <p class="ar">ุณูุชู ูุงุฑุบุฉ ุญุงูููุง</p>
            </div>
            <button @click="closeCart(); navigateToOrScroll('udheya')" class="btn btn-primary bilingual-inline" style="margin-top:var(--space)">
                <span class="en">Start Shopping</span><span class="ar">ุงุจุฏุฃ ุงูุชุณูู</span>
            </button>
        </div>
        
        <div x-show="cartItems.length > 0">
            <template x-for="item in cartItems" :key="item.uniqueIdInCart">
                <div class="cart-item">
                    <div class="cart-item-details">
                        <div class="cart-item-name bilingual">
                            <span class="en" x-text="item.nameENSpec"></span>
                            <span class="ar" x-text="item.nameARSpec"></span>
                        </div>
                        <template x-if="item.product_category === 'udheya' && item.udheya_details">
                            <div class="cart-item-meta bilingual">
                                <span class="en">Service: <span x-text="item.udheya_details.serviceOption === 'standard_service' ? 'Standard' : 'Live Animal'"></span></span>
                                <span class="ar">ุงูุฎุฏูุฉ: <span x-text="item.udheya_details.serviceOption === 'standard_service' ? 'ุนุงุฏูุฉ' : 'ุญููุงู ุญู'"></span></span>
                            </div>
                        </template>
                        <div class="cart-item-price bilingual">
                            <span class="en" x-text="fmtPrice(item.priceEGP) + ' each'"></span>
                            <span class="ar" x-text="fmtPrice(item.priceEGP) + ' ูููุทุนุฉ'"></span>
                        </div>
                    </div>
                    
                    <div class="cart-controls">
                        <div class="quantity-controls">
                            <button class="quantity-btn" @click="item.quantity === 1 ? removeFromCart(item.uniqueIdInCart) : updateCartQuantity(item.uniqueIdInCart, item.quantity - 1)">โ</button>
                            <span class="quantity-display" x-text="item.quantity"></span>
                            <button class="quantity-btn" @click="updateCartQuantity(item.uniqueIdInCart, item.quantity + 1)" :disabled="item.quantity >= item.stock || (item.product_category === 'udheya' && item.quantity >= 1)">+</button>
                        </div>
                        <div class="cart-item-total" x-text="fmtPrice(getSubtotalForItem(item))"></div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    
    <div class="cart-footer" x-show="cartItems.length > 0">
        <div class="cart-total bilingual">
            <span class="en">Total</span><span class="ar">ุงูุฅุฌูุงูู</span>
            <span x-text="fmtPrice(calculateCartTotal())"></span>
        </div>
        <button @click="closeCart(); navigateToOrScroll('checkout')" class="btn btn-primary btn-block bilingual-inline">
            <span class="en">Proceed to Checkout</span><span class="ar">ุงููุชุงุจุนุฉ ููุฏูุน</span>
        </button>
    </div>
</aside>

<!-- Header -->
<header class="header">
    <div class="container header-content">
        <a href="#home" class="logo bilingual-inline" @click.prevent="navigateToOrScroll('home')">
            <span class="en">๐ Sheep Land</span><span class="ar">ุฃุฑุถ ุงูุฃุบูุงู</span>
        </a>

        <nav class="nav-main">
            <template x-if="settings.enable_udheya_section">
                <a href="#udheya" class="nav-link bilingual-inline" :class="{'active': currentPage === 'udheya'}" @click.prevent="navigateToOrScroll('udheya')">
                    <span class="en">Udheya</span><span class="ar">ุงูุฃุถุญูุฉ</span>
                </a>
            </template>
            <template x-if="settings.enable_livestock_section">
                <a href="#livestock" class="nav-link bilingual-inline" :class="{'active': currentPage === 'livestock'}" @click.prevent="navigateToOrScroll('livestock')">
                    <span class="en">Livestock</span><span class="ar">ุงูุฃุบูุงู</span>
                </a>
            </template>
            <template x-if="settings.enable_meat_section">
                <a href="#meat" class="nav-link bilingual-inline" :class="{'active': currentPage === 'meat'}" @click.prevent="navigateToOrScroll('meat')">
                    <span class="en">Meat</span><span class="ar">ุงููุญูู</span>
                </a>
            </template>
            <template x-if="settings.enable_gatherings_section">
                <a href="#gatherings" class="nav-link bilingual-inline" :class="{'active': currentPage === 'gatherings'}" @click.prevent="navigateToOrScroll('gatherings')">
                    <span class="en">Gatherings</span><span class="ar">ุงูููุงุฆู</span>
                </a>
            </template>
            <template x-if="currentUser">
                <a href="#account" class="nav-link bilingual-inline" :class="{'active': currentPage === 'account'}" @click.prevent="navigateToOrScroll('account')">
                    <span class="en">Account</span><span class="ar">ุญุณุงุจู</span>
                </a>
            </template>
        </nav>

        <div class="header-actions">
            <button @click="openOrderStatusModal()" class="header-btn" title="Order Status">๐</button>
            <template x-if="!currentUser">
                <button @click="navigateToOrScroll('auth')" class="header-btn" title="Login">๐ค</button>
            </template>
            <template x-if="currentUser">
                <button @click="navigateToOrScroll('account')" class="header-btn" title="My Account">๐ค</button>
            </template>
            <button @click="openCart()" class="header-btn" title="Cart">
                ๐<span x-show="cartItems.length > 0" class="cart-badge" x-text="cartItemCount"></span>
            </button>
            <select x-model="curr" class="form-select" style="width:auto;padding:var(--space-xs) var(--space-sm);font-size:var(--text-sm)">
                <template x-for="code in Object.keys(settings.xchgRates)" :key="code">
                    <option :value="code" x-text="code" :disabled="!settings.xchgRates[code].is_active"></option>
                </template>
            </select>
            <a :href="'https://wa.me/' + settings.waNumRaw" target="_blank" class="header-btn bilingual-inline" title="WhatsApp Contact">
                ๐ฑ <span x-text="settings.waNumDisp" style="font-size:var(--text-sm);margin-left:var(--space-xs)"></span>
            </a>
            <button class="mobile-menu-btn header-btn" @click="isMobNavOpen = !isMobNavOpen">โฐ</button>
        </div>

        <div class="mobile-nav" x-show="isMobNavOpen" x-transition @click.outside="isMobNavOpen = false">
            <div class="mobile-nav-list">
                <template x-if="settings.enable_udheya_section">
                    <a href="#udheya" class="nav-link bilingual-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('udheya')">
                        <span class="en">Udheya</span><span class="ar">ุงูุฃุถุญูุฉ</span>
                    </a>
                </template>
                <template x-if="settings.enable_livestock_section">
                    <a href="#livestock" class="nav-link bilingual-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('livestock')">
                        <span class="en">Livestock</span><span class="ar">ุงูุฃุบูุงู</span>
                    </a>
                </template>
                <template x-if="settings.enable_meat_section">
                    <a href="#meat" class="nav-link bilingual-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('meat')">
                        <span class="en">Meat</span><span class="ar">ุงููุญูู</span>
                    </a>
                </template>
                <template x-if="settings.enable_gatherings_section">
                    <a href="#gatherings" class="nav-link bilingual-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('gatherings')">
                        <span class="en">Gatherings</span><span class="ar">ุงูููุงุฆู</span>
                    </a>
                </template>
                <template x-if="currentUser">
                    <a href="#account" class="nav-link bilingual-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('account')">
                        <span class="en">My Account</span><span class="ar">ุญุณุงุจู</span>
                    </a>
                    <button @click="logoutUser(); isMobNavOpen = false;" class="nav-link bilingual-inline" style="background:none;border:none;width:100%;text-align:center">
                        <span class="en">Logout</span><span class="ar">ุฎุฑูุฌ</span>
                    </button>
                </template>
            </div>
            
            <div class="mobile-nav-actions">
                <button @click="openOrderStatusModal(); isMobNavOpen = false;" class="header-btn">๐</button>
                <template x-if="!currentUser">
                    <button @click="navigateToOrScroll('auth'); isMobNavOpen = false;" class="header-btn">๐ค</button>
                </template>
                <button @click="openCart(); isMobNavOpen = false;" class="header-btn">
                    ๐<span x-show="cartItems.length > 0" class="cart-badge" x-text="cartItemCount"></span>
                </button>
            </div>
            
            <div class="mobile-contact">
                <a :href="'https://wa.me/' + settings.waNumRaw" target="_blank" class="bilingual-inline" style="color:var(--primary);text-decoration:none">
                    ๐ฑ <span x-text="settings.waNumDisp"></span>
                </a>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main style="flex:1">
    <!-- Home Section -->
    <section class="hero" x-show="currentPage === 'home'" x-transition>
        <div class="container hero-content">
            <h1 class="bilingual-center">
                <span class="en">Premium Udheya & Livestock</span>
                <span class="ar">ุฃุถุงุญู ูููุงุดู ูุงุฎุฑุฉ</span>
            </h1>
            <div class="bilingual-center">
                <p class="en">Experience the tradition of Udheya with ease and quality. Farm-fresh, Sharia-compliant livestock and meats delivered to your doorstep.</p>
                <p class="ar">ุนุด ุชุฌุฑุจุฉ ุงูุฃุถุญูุฉ ุงูุชูููุฏูุฉ ุจุณูููุฉ ูุฌูุฏุฉ. ููุงุดู ููุญูู ุทุงุฒุฌุฉ ูู ุงููุฒุฑุนุฉุ ูุชูุงููุฉ ูุน ุงูุดุฑูุนุฉุ ุชุตูู ุญุชู ุจุงุจ ููุฒูู.</p>
            </div>
            <button @click="navigateToOrScroll('udheya')" class="btn btn-secondary btn-lg bilingual-inline">
                <span class="en">Explore Udheya Options</span><span class="ar">ุชุตูุญ ุฎูุงุฑุงุช ุงูุฃุถุงุญู</span>
            </button>
            
            <template x-if="settings.promoActive && !cd.ended">
                <div class="promo-banner">
                    <div class="bilingual-center">
                        <p class="en"><strong>๐ Special Offer: <span x-text="settings.promoDiscPc"></span>% OFF Udheya!</strong></p>
                        <p class="ar"><strong>๐ ุนุฑุถ ุฎุงุต: ุฎุตู <span x-text="settings.promoDiscPc"></span>% ุนูู ุงูุฃุถุงุญู!</strong></p>
                    </div>
                    <div class="countdown">
                        <div class="countdown-item">
                            <div class="countdown-value" x-text="cd.days"></div>
                            <div class="countdown-label">Days</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" x-text="cd.hours"></div>
                            <div class="countdown-label">Hrs</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" x-text="cd.mins"></div>
                            <div class="countdown-label">Min</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" x-text="cd.secs"></div>
                            <div class="countdown-label">Sec</div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Product Sections -->
    <template x-for="section in [
        {key: 'udheya', name: {en: 'Order Your Udheya', ar: 'ุงุทูุจ ุฃุถุญูุชู'}, products: prodOpts.udheya, badge: 'UDHEYA'},
        {key: 'livestock', name: {en: 'Our Livestock', ar: 'ุฃุบูุงููุง'}, products: prodOpts.livestock_general, badge: 'LIVESTOCK'},
        {key: 'meat', name: {en: 'Fresh Meat Cuts', ar: 'ูุทุนูุงุช ุงููุญูู ุงูุทุงุฒุฌุฉ'}, products: prodOpts.meat_cuts, badge: 'MEAT'},
        {key: 'gatherings', name: {en: 'Gatherings & Feasts', ar: 'ุงูููุงุฆู ูุงูููุงุณุจุงุช'}, products: prodOpts.gathering_package, badge: 'FEAST'}
    ]" :key="section.key">
        <section class="section" x-show="currentPage === section.key && settings['enable_' + section.key + '_section']" x-transition>
            <div class="container">
                <div style="margin-bottom:var(--space-2xl)">
                    <h1 class="bilingual text-center">
                        <span class="en" x-text="section.name.en"></span>
                        <span class="ar" x-text="section.name.ar"></span>
                    </h1>
                </div>
                
                <div x-show="section.products && section.products.length > 0" class="product-grid">
                    <template x-for="productType in section.products" :key="productType.valKey">
                        <template x-for="item in productType.wps" :key="item.itemKey">
                            <div class="card product-card">
                                <div class="product-image">
                                    <img :src="'images/' + productType.valKey + (section.key === 'meat' ? '-cuts' : section.key === 'gatherings' ? '-gathering' : '-sheep') + '.jpg'" :alt="item.nameENSpec" loading="lazy">
                                    <div class="product-badge" x-text="section.badge"></div>
                                </div>
                                <div class="card-body product-content">
                                    <h3 class="product-title bilingual">
                                        <span class="en" x-text="item.nameENSpec"></span>
                                        <span class="ar" x-text="item.nameARSpec"></span>
                                    </h3>
                                    <div class="product-description bilingual">
                                        <p class="en" x-text="item.descEn || productType.descEn"></p>
                                        <p class="ar" x-text="item.descAr || productType.descAr"></p>
                                    </div>
                                    <div class="product-price" x-text="fmtPrice(item.priceEGP)"></div>
                                    <div class="product-actions">
                                        <template x-if="section.key === 'udheya'">
                                            <div style="display:flex;gap:var(--space-sm);width:100%">
                                                <button @click="openUdheyaConfiguration(item, false)" class="btn btn-secondary btn-sm" :disabled="!item.isActive || item.stock <= 0" style="flex:1">
                                                    <span class="bilingual-inline">
                                                        <span class="en">Configure</span><span class="ar">ุฎุตุต</span>
                                                    </span>
                                                </button>
                                                <button @click="openUdheyaConfiguration(item, true)" class="btn btn-primary btn-sm" :disabled="!item.isActive || item.stock <= 0" style="flex:1">
                                                    <span class="bilingual-inline">
                                                        <span class="en">Buy Now</span><span class="ar">ุงุดุชุฑ ุงูุขู</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </template>
                                        <template x-if="section.key !== 'udheya'">
                                            <div style="display:flex;gap:var(--space-sm);width:100%">
                                                <button @click="addItemToCart(item)" class="btn btn-secondary btn-sm" :disabled="!item.isActive || item.stock <= 0" style="flex:1">
                                                    <span class="bilingual-inline">
                                                        <span class="en">Add to Cart</span><span class="ar">ุฃุถู ููุณูุฉ</span>
                                                    </span>
                                                </button>
                                                <button @click="buyNow(item)" class="btn btn-primary btn-sm" :disabled="!item.isActive || item.stock <= 0" style="flex:1">
                                                    <span class="bilingual-inline">
                                                        <span class="en">Buy Now</span><span class="ar">ุงุดุชุฑ ุงูุขู</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </template>
                                    </div>
                                    <div class="product-stock bilingual" :class="{'out-of-stock': !item.isActive || item.stock <= 0}">
                                        <span class="en" x-text="getStockDisplayInfo(item.stock, item.isActive, 'en')"></span>
                                        <span class="ar" x-text="getStockDisplayInfo(item.stock, item.isActive, 'ar')"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </template>
                </div>
                
                <div x-show="(!section.products || section.products.length === 0) && !load.init" class="cart-empty">
                    <div class="bilingual-center">
                        <p class="en">Products are currently being updated. Please check back soon!</p>
                        <p class="ar">ูุชู ุชุญุฏูุซ ุงูููุชุฌุงุช ุญุงูููุง. ูุฑุฌู ุงูุชุญูู ูุฑุฉ ุฃุฎุฑู ูุฑูุจูุง!</p>
                    </div>
                    <button @click="navigateToOrScroll('home')" class="btn btn-primary bilingual-inline">
                        <span class="en">Back to Home</span><span class="ar">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</span>
                    </button>
                </div>
                
                <div x-show="addedToCartMsg.text && addedToCartMsg.pageContext === section.key" 
                     :class="addedToCartMsg.isError ? 'alert alert-error' : 'alert alert-success'">
                    <span class="bilingual">
                        <span class="en" x-text="addedToCartMsg.text ? (addedToCartMsg.text.en || addedToCartMsg.text) : ''"></span>
                        <span class="ar" x-text="addedToCartMsg.text ? (addedToCartMsg.text.ar || addedToCartMsg.text) : ''"></span>
                    </span>
                </div>
            </div>
        </section>
    </template>
</main>

<script src="vendor/pocketbase.umd.js"></script>
<script defer src="vendor/alpine.min.js"></script>
<script src="main.js"></script>

</body>
</html>

<!-- Loading & Error States -->
<div x-show="load.init && !apiErr" class="load-ind" aria-live="polite">Loading application data... Please wait.</div>
<div x-show="apiErr" class="err-ind" x-text="usrApiErr || 'An unexpected error occurred. Please try again.'" role="alert" aria-live="assertive" tabindex="-1"></div>

<!-- Cart Sidebar -->
<div x-show="isCartOpen" class="cart-sidebar-overlay" @click="closeCart()" x-transition:enter="transition-opacity ease-linear duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-linear duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"></div>
<aside x-show="isCartOpen" class="cart-sidebar" x-transition:enter="transition ease-in-out duration-300 transform" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in-out duration-300 transform" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full" role="dialog" aria-modal="true" aria-labelledby="cart-sidebar-title" @keydown.escape.window="closeCart()">
    <div class="cart-sidebar-header">
        <h2 id="cart-sidebar-title" class="bil-spread modal-title">
            <span class="en">Your Cart</span><span class="ar">ุณูุชู</span>
        </h2>
        <button @click="closeCart()" class="modal-close-btn" aria-label="Close cart">ร</button>
    </div>
    <div class="cart-sidebar-content">
        <div x-show="cartItems.length === 0" class="tc cart-empty-msg">
            <p class="bil-row"><span class="en">Your cart is currently empty.</span><span class="ar">ุณูุชู ูุงุฑุบุฉ ุญุงูููุง.</span></p>
            <button @click="closeCart(); navigateToOrScroll('udheya')" class="btn bp btn-sm bil-inline">
                <span class="en">Start Shopping</span><span class="ar">ุงุจุฏุฃ ุงูุชุณูู</span>
            </button>
        </div>
        <div x-show="cartItems.length > 0">
            <template x-for="(cartItem) in cartItems" :key="cartItem.uniqueIdInCart">
                <div class="cart-item">
                    <div class="cart-item-details">
                        <div class="cart-item-name bil-spread">
                            <span class="en" x-text="cartItem.nameENSpec"></span>
                            <span class="ar" x-text="cartItem.nameARSpec"></span>
                        </div>
                        <template x-if="cartItem.product_category === 'udheya' && cartItem.udheya_details">
                            <div class="udheya-detail bil-spread">
                                <span class="en"><small>Service: <span x-text="cartItem.udheya_details.serviceOption === 'standard_service' ? 'Standard' : 'Live Animal'"></span></small></span>
                                <span class="ar"><small>ุงูุฎุฏูุฉ: <span x-text="cartItem.udheya_details.serviceOption === 'standard_service' ? 'ุนุงุฏูุฉ' : 'ุญููุงู ุญู'"></span></small></span>
                            </div>
                        </template>
                        <div class="cart-item-price bil-spread">
                            <span class="en" x-text="fmtPrice(cartItem.priceEGP) + ' each'"></span>
                            <span class="ar" x-text="fmtPrice(cartItem.priceEGP) + ' ูููุทุนุฉ'"></span>
                        </div>
                    </div>
                    
                    <div class="cart-item-controls">
                        <div class="cart-item-quantity">
                            <button type="button" @click="cartItem.quantity === 1 ? removeFromCart(cartItem.uniqueIdInCart) : updateCartQuantity(cartItem.uniqueIdInCart, cartItem.quantity - 1)" class="btn btn-sm qty-btn">-</button>
                            <span class="cart-qty-display" x-text="cartItem.quantity"></span>
                            <button type="button" @click="updateCartQuantity(cartItem.uniqueIdInCart, cartItem.quantity + 1)" class="btn btn-sm qty-btn" :disabled="cartItem.quantity >= cartItem.stock || (cartItem.product_category === 'udheya' && cartItem.quantity >=1 )">+</button>
                        </div>
                        <div class="cart-item-subtotal" x-text="fmtPrice(getSubtotalForItem(cartItem))"></div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <div class="cart-sidebar-footer" x-show="cartItems.length > 0">
        <div class="cart-total bil-row">
            <span class="en"><strong>Total:</strong> <span x-text="fmtPrice(calculateCartTotal())"></span></span>
            <span class="ar"><strong>ุงูุฅุฌูุงูู:</strong> <span x-text="fmtPrice(calculateCartTotal())"></span></span>
        </div>
        <button type="button" @click="closeCart(); navigateToOrScroll('checkout')" class="btn bac btn-lg btn-block bil-inline">
            <span class="en">Proceed to Checkout</span><span class="ar">ุงููุชุงุจุนุฉ ููุฏูุน</span>
        </button>
    </div>
</aside>

<!-- Modals -->
<div x-show="isRefundModalOpen" class="modal-overlay" @click="closeRefundModal()"></div>
<div x-show="isRefundModalOpen" class="modal" role="dialog" aria-modal="true" aria-labelledby="refund-modal-title" @keydown.escape.window="closeRefundModal()">
    <div class="modal-header">
        <h2 id="refund-modal-title" class="bil-spread modal-title">
            <span class="en">Refund & Cancellation Policy</span><span class="ar" dir="rtl">ุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ ูุงูุฅูุบุงุก</span>
        </h2>
        <button @click="closeRefundModal()" class="modal-close-btn">ร</button>
    </div>
    <div class="modal-content policy-container">
         <div x-html="settings.refundPolicyHTMLContent || '<p>Loading refund policy...</p>'"></div>
    </div>
    <div class="modal-footer">
        <button @click="closeRefundModal()" class="btn bp">Close</button>
    </div>
</div>

<div x-show="isOrderStatusModalOpen" class="modal-overlay" @click="closeOrderStatusModal()"></div>
<div x-show="isOrderStatusModalOpen" class="modal" role="dialog" aria-modal="true" aria-labelledby="order-status-modal-title" @keydown.escape.window="closeOrderStatusModal()">
    <div class="modal-header">
        <h2 id="order-status-modal-title" class="bil-spread modal-title">
            <span class="en">Check Order Status</span><span class="ar">ุชุญูู ูู ุญุงูุฉ ุงูุทูุจ</span>
        </h2>
        <button @click="closeOrderStatusModal()" class="modal-close-btn">ร</button>
    </div>
    <div class="modal-content">
        <form @submit.prevent="submitStatValid()" novalidate>
            <div class="fg">
                <label for="order_id_lookup_modal" class="bil-spread lbl-req"><span class="en">Enter Order ID *</span><span class="ar">ุฃุฏุฎู ุฑูู ุงูุทูุจ *</span></label>
                <input type="text" id="order_id_lookup_modal" class="input" x-model="lookupOrderID" placeholder="e.g., A1B2C3D4E5" x-ref="lookupOrderIdInputModal" @input="clrErr('lookupOrderID')">
                <div class="err-msg" x-show="errs.lookupOrderID" x-text="errs.lookupOrderID ? (currLang === 'ar' ? errs.lookupOrderID.ar : errs.lookupOrderID.en) : ''"></div>
            </div>
            <div class="card-act">
                <button type="submit" class="btn bp btn-block bil-inline" :disabled="load.status">
                    <span x-show="!load.status"><span class="en">Check Status</span><span class="ar">ุชุญูู ูู ุงูุญุงูุฉ</span></span>
                    <span x-show="load.status"><span class="en">Checking...</span><span class="ar">ุฌุงุฑู...</span></span>
                </button>
            </div>
        </form>
        <div class="order-stat-res" x-show="load.status || statRes || statNotFound">
            <div x-show="load.status && !statRes && !statNotFound" class="load-text tc">Checking...</div>
            <div x-show="statRes && !load.status">
                <h4 class="form-subh bil-spread"><span class="en">Order Details</span><span class="ar">ุชูุงุตูู ุงูุทูุจ</span></h4>
                <div class="sum-item bil-row"><div class="en"><strong>ID:</strong> <span x-text="statRes?.orderIdTxt || ''"></span></div><div class="ar"><strong>ุฑูู ุงูุทูุจ:</strong> <span x-text="statRes?.orderIdTxt || ''"></span></div></div>
                <div class="sum-item bil-row"><div class="en"><strong>Status:</strong> <span class="stat-hl" x-text="statRes?.order_status || ''"></span></div><div class="ar"><strong>ุญุงูุฉ ุงูุทูุจ:</strong> <span class="stat-hl" x-text="statRes?.order_status || ''"></span></div></div>
                <div class="sum-item bil-row"><div class="en"><strong>Total:</strong> <span x-text="fmtPrice(statRes?.total_amount_due_egp)"></span></div><div class="ar"><strong>ุฅุฌูุงูู ุงูุทูุจ:</strong> <span x-text="fmtPrice(statRes?.total_amount_due_egp)"></span></div></div>
            </div>
            <div class="stat-no-res bil-row tc" x-show="statNotFound && !statRes && !load.status"><p class="en">No order found. Check ID or contact support.</p><p class="ar">ูู ูุชู ุงูุนุซูุฑ ุนูู ุทูุจ. ุชุญูู ูู ุฑูู ุงูุทูุจ ุฃู ุงุชุตู ุจุงูุฏุนู.</p></div>
        </div>
    </div>
    <div class="modal-footer">
        <button @click="closeOrderStatusModal()" class="btn bp">Close</button>
    </div>
</div>

<div x-show="isUdheyaConfigModalOpen" class="modal-overlay" @click="closeUdheyaConfiguration()"></div>
<div x-show="isUdheyaConfigModalOpen" class="modal udheya-config-modal" role="dialog" aria-modal="true" @keydown.escape.window="closeUdheyaConfiguration()">
    <div class="modal-header">
        <h2 class="bil-spread modal-title">
            <span class="en">Configure Your Udheya</span><span class="ar" dir="rtl">ุชุฎุตูุต ุงูุฃุถุญูุฉ</span>
        </h2>
        <button @click="closeUdheyaConfiguration()" class="modal-close-btn">ร</button>
    </div>
    <div class="modal-content">
        <div x-show="configuringUdheyaItem">
            <h3 class="bil-spread modal-section-title"><span x-text="configuringUdheyaItem?.nameENSpec"></span><span x-text="configuringUdheyaItem?.nameARSpec"></span></h3>
            <div class="fg">
                <label class="bil-spread lbl-req"><span class="en">Service Option *</span><span class="ar">ุฎูุงุฑ ุงูุฎุฏูุฉ *</span></label>
                <div class="rgrp">
                    <label class="bil-spread"><input type="radio" name="service_option_udh_conf" value="standard_service" x-model="tempUdheyaConfig.serviceOption" @change="clrErr('udheya_service_config')"><span class="en">Standard Service - <strong x-text="fmtPrice(settings.servFeeEGP)"></strong></span><span class="ar">ุฎุฏูุฉ ุนุงุฏูุฉ - <strong x-text="fmtPrice(settings.servFeeEGP)"></strong></span></label>
                    <label class="bil-spread"><input type="radio" name="service_option_udh_conf" value="live_animal_delivery" x-model="tempUdheyaConfig.serviceOption" @change="clrErr('udheya_service_config')"><span class="en">Live Animal Delivery</span><span class="ar">ุชูุตูู ุญููุงู ุญู</span></label>
                </div>
                <div class="err-msg" x-show="errs.udheya_service_config" x-text="getUdheyaConfigErrorText()"></div>
            </div>
            <div class="fg" x-show="tempUdheyaConfig.serviceOption === 'standard_service'">
                <label class="bil-spread lbl-req"><span class="en">Sacrifice Day *</span><span class="ar">ููู ุงูุฐุจุญ *</span></label>
                <select class="input" x-model="tempUdheyaConfig.sacrificeDay" @change="clrErr('udheya_sacrifice_day_config')">
                    <option value="">-- Select Day --</option>
                    <template x-for="(dayInfo, dayValue) in sacrificeDayMapInternal" :key="dayValue">
                        <option :value="dayValue"><span x-text="dayInfo.en + ' / ' + dayInfo.ar"></span></option>
                    </template>
                </select>
            </div>
            <div class="fg">
                <label class="bil-spread lbl-req"><span class="en">Distribution Choice *</span><span class="ar">ุฎูุงุฑ ุงูุชูุฒูุน *</span></label>
                <div class="rgrp">
                    <template x-for="opt in distrOpts()" :key="opt.val">
                        <label class="bil-spread"><input type="radio" name="distribution_choice_udh_conf" :value="opt.val" x-model="tempUdheyaConfig.distribution.choice" @change="clrErr('udheya_distribution_choice_config')"><span x-text="opt.txtEn"></span><span x-text="opt.txtAr"></span></label>
                    </template>
                </div>
                <div x-show="tempUdheyaConfig.distribution.choice === 'split'">
                    <template x-for="opt in splitOptsList()" :key="opt.val">
                         <label class="bil-spread"><input type="radio" name="split_option_udh_conf" :value="opt.val" x-model="tempUdheyaConfig.distribution.splitOption"><span x-text="opt.txtEn"></span><span x-text="opt.txtAr"></span></label>
                    </template>
                    <textarea x-show="tempUdheyaConfig.distribution.splitOption === 'custom'" class="input" rows="2" x-model="tempUdheyaConfig.distribution.customSplitText" placeholder="Specify custom distribution"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" @click="closeUdheyaConfiguration()" class="btn bp-alt"><span class="en">Cancel</span><span class="ar">ุฅูุบุงุก</span></button>
        <button type="button" @click="confirmUdheyaConfigurationAndProceed()" class="btn bac">
            <span x-text="tempUdheyaConfig.isBuyNowIntent ? 'Confirm & Buy Now' : 'Confirm & Add to Cart'"></span>
        </button>
    </div>
</div>

<!-- Header -->
<header class="site-head">
    <div class="c nav-cont">
        <a href="#home" class="logo bil-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('home')">
            <span class="en">Sheep Land</span><span class="ar">ุฃุฑุถ ุงูุฃุบูุงู</span>
        </a>

        <nav class="nav-main nav-desk">
            <ul class="nav-list">
                <template x-if="settings.enable_udheya_section">
                    <li><a href="#udheya" class="nav-link bil-inline" :class="{'active-nav': currentPage === 'udheya'}" @click.prevent="navigateToOrScroll('udheya')"><span class="en">Udheya</span><span class="ar">ุงูุฃุถุญูุฉ</span></a></li>
                </template>
                <template x-if="settings.enable_livestock_section">
                    <li><a href="#livestock" class="nav-link bil-inline" :class="{'active-nav': currentPage === 'livestock'}" @click.prevent="navigateToOrScroll('livestock')"><span class="en">Livestock</span><span class="ar">ุงูุฃุบูุงู</span></a></li>
                </template>
                <template x-if="settings.enable_meat_section">
                    <li><a href="#meat" class="nav-link bil-inline" :class="{'active-nav': currentPage === 'meat'}" @click.prevent="navigateToOrScroll('meat')"><span class="en">Meat</span><span class="ar">ุงููุญูู</span></a></li>
                </template>
                <template x-if="settings.enable_gatherings_section">
                    <li><a href="#gatherings" class="nav-link bil-inline" :class="{'active-nav': currentPage === 'gatherings'}" @click.prevent="navigateToOrScroll('gatherings')"><span class="en">Gatherings</span><span class="ar">ุงูููุงุฆู</span></a></li>
                </template>
                <template x-if="currentUser">
                    <li><a href="#account" class="nav-link bil-inline" :class="{'active-nav': currentPage === 'account'}" @click.prevent="navigateToOrScroll('account')"><span class="en">My Account</span><span class="ar">ุญุณุงุจู</span></a></li>
                    <li><button @click="logoutUser()" class="nav-link bil-inline as-button"><span class="en">Logout</span><span class="ar">ุฎุฑูุฌ</span></button></li>
                </template>
            </ul>
        </nav>

        <div class="head-extras desk-extras">
            <button @click="openOrderStatusModal()" class="header-action-btn">๐</button>
            <template x-if="!currentUser">
                <button @click="navigateToOrScroll('auth')" class="header-action-btn">๐ค</button>
            </template>
            <template x-if="currentUser">
                <button @click="navigateToOrScroll('account')" class="header-action-btn">๐ค</button>
            </template>
            <button @click="openCart()" class="header-action-btn">
                ๐<span x-show="cartItems.length > 0" class="cart-count-badge" x-text="cartItemCount"></span>
            </button>
            <select x-model="curr" class="curr-sel">
                <template x-for="code in Object.keys(settings.xchgRates)" :key="code">
                    <option :value="code" x-text="code" :disabled="!settings.xchgRates[code].is_active"></option>
                </template>
            </select>
            <div class="wa-contact">
                <a :href="'https://wa.me/' + settings.waNumRaw" target="_blank" rel="noopener noreferrer">
                    ๐ฑ <span x-text="settings.waNumDisp"></span>
                </a>
            </div>
        </div>

        <button class="menu-btn" @click="isMobNavOpen = !isMobNavOpen">โฐ</button>
    </div>

    <div class="mob-nav" x-show="isMobNavOpen" x-transition @click.outside="isMobNavOpen = false">
        <nav>
            <ul class="nav-list-mob">
                <template x-if="settings.enable_udheya_section">
                    <li><a href="#udheya" class="nav-link-mob bil-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('udheya')"><span class="en">Udheya</span><span class="ar">ุงูุฃุถุญูุฉ</span></a></li>
                </template>
                <template x-if="settings.enable_livestock_section">
                    <li><a href="#livestock" class="nav-link-mob bil-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('livestock')"><span class="en">Livestock</span><span class="ar">ุงูุฃุบูุงู</span></a></li>
                </template>
                <template x-if="settings.enable_meat_section">
                    <li><a href="#meat" class="nav-link-mob bil-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('meat')"><span class="en">Meat</span><span class="ar">ุงููุญูู</span></a></li>
                </template>
                <template x-if="settings.enable_gatherings_section">
                    <li><a href="#gatherings" class="nav-link-mob bil-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('gatherings')"><span class="en">Gatherings</span><span class="ar">ุงูููุงุฆู</span></a></li>
                </template>
                <template x-if="currentUser">
                    <li><a href="#account" class="nav-link-mob bil-inline" @click.prevent="isMobNavOpen = false; navigateToOrScroll('account')"><span class="en">My Account</span><span class="ar">ุญุณุงุจู</span></a></li>
                    <li><button @click="logoutUser(); isMobNavOpen = false;" class="nav-link-mob bil-inline as-button"><span class="en">Logout</span><span class="ar">ุฎุฑูุฌ</span></button></li>
                </template>
            </ul>
            
            <div class="nav-actions-mob">
                <button @click="openOrderStatusModal(); isMobNavOpen = false;" class="nav-link-mob as-button">๐</button>
                <template x-if="!currentUser">
                    <button @click="navigateToOrScroll('auth'); isMobNavOpen = false;" class="nav-link-mob as-button">๐ค</button>
                </template>
                <template x-if="currentUser">
                    <button @click="navigateToOrScroll('account'); isMobNavOpen = false;" class="nav-link-mob as-button">๐ค</button>
                </template>
                <button @click="openCart(); isMobNavOpen = false;" class="nav-link-mob as-button">๐<span x-show="cartItems.length > 0" class="cart-count-badge" x-text="cartItemCount"></span></button>
            </div>
            
            <div class="wa-contact-mob">
                <a :href="'https://wa.me/' + settings.waNumRaw" target="_blank" rel="noopener noreferrer">
                    ๐ฑ <span x-text="settings.waNumDisp"></span>
                </a>
            </div>
        </nav>
    </div>
</header>

<!-- Main Content -->
<main>
    <!-- Home Section -->
    <section class="hero main-page-sec" x-show="currentPage === 'home'" x-transition>
        <div class="c tc">
            <h1 class="bil-spread hero-h"><span class="en">Premium Udheya & Livestock</span><span class="ar">ุฃุถุงุญู ูููุงุดู ูุงุฎุฑุฉ</span></h1>
            <div class="hero-desc bil-row"><p class="en">Experience the tradition of Udheya with ease and quality. Farm-fresh, Sharia-compliant livestock and meats delivered to your doorstep.</p><p class="ar">ุนุด ุชุฌุฑุจุฉ ุงูุฃุถุญูุฉ ุงูุชูููุฏูุฉ ุจุณูููุฉ ูุฌูุฏุฉ. ููุงุดู ููุญูู ุทุงุฒุฌุฉ ูู ุงููุฒุฑุนุฉุ ูุชูุงููุฉ ูุน ุงูุดุฑูุนุฉุ ุชุตูู ุญุชู ุจุงุจ ููุฒูู.</p></div>
            <button @click="navigateToOrScroll('udheya')" class="btn bac btn-lg bil-inline hero-cta"><span class="en">Explore Udheya Options</span><span class="ar">ุชุตูุญ ุฎูุงุฑุงุช ุงูุฃุถุงุญู</span></button>
            
            <template x-if="settings.promoActive && !cd.ended">
                <div class="hero-promo">
                    <div class="pban">
                        <div class="pban-text">
                            <h3 class="prm-h bil-row">
                                <span class="en" x-html="`๐ Special Offer: <strong>${settings.promoDiscPc}% OFF</strong> Udheya! Ends in:`"></span>
                                <span class="ar" x-html="`๐ ุนุฑุถ ุฎุงุต: <strong>ุฎุตู ${settings.promoDiscPc}%</strong> ุนูู ุงูุฃุถุงุญู! ููุชูู ุฎูุงู:`"></span>
                            </h3>
                        </div>
                        <div class="cd-wrap">
                            <div class="cd">
                                <div class="cd-seg"><span class="cd-val" x-text="cd.days"></span><span class="cd-lbl">Days</span></div>:
                                <div class="cd-seg"><span class="cd-val" x-text="cd.hours"></span><span class="cd-lbl">Hrs</span></div>:
                                <div class="cd-seg"><span class="cd-val" x-text="cd.mins"></span><span class="cd-lbl">Min</span></div>:
                                <div class="cd-seg"><span class="cd-val" x-text="cd.secs"></span><span class="cd-lbl">Sec</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Product Sections -->
    <template x-for="section in [
        {key: 'udheya', name: {en: 'Order Your Udheya', ar: 'ุงุทูุจ ุฃุถุญูุชู'}, products: prodOpts.udheya, badge: 'UDHEYA'},
        {key: 'livestock', name: {en: 'Our Livestock', ar: 'ุฃุบูุงููุง'}, products: prodOpts.livestock_general, badge: 'LIVESTOCK'},
        {key: 'meat', name: {en: 'Fresh Meat Cuts', ar: 'ูุทุนูุงุช ุงููุญูู ุงูุทุงุฒุฌุฉ'}, products: prodOpts.meat_cuts, badge: 'MEAT'},
        {key: 'gatherings', name: {en: 'Gatherings & Feasts', ar: 'ุงูููุงุฆู ูุงูููุงุณุจุงุช'}, products: prodOpts.gathering_package, badge: 'FEAST'}
    ]" :key="section.key">
        <section class="main-page-sec sec" :class="section.key === 'livestock' ? 'order-sect' : ''" x-show="currentPage === section.key && settings['enable_' + section.key + '_section']" x-transition>
            <div class="c">
                <div class="sec-head">
                    <h1 class="bil-spread" tabindex="-1">
                        <span class="en" x-text="section.name.en"></span><span class="ar" x-text="section.name.ar"></span>
                    </h1>
                </div>
                <div x-show="section.products && section.products.length > 0" class="prod-grid grid2">
                    <template x-for="productType in section.products" :key="productType.valKey">
                        <template x-for="item in productType.wps" :key="item.itemKey">
                            <div class="card card-live">
                                <div class="card-img">
                                    <img :src="'images/' + productType.valKey + (section.key === 'meat' ? '-cuts' : section.key === 'gatherings' ? '-gathering' : '-sheep') + '.jpg'" :alt="item.nameENSpec" loading="lazy">
                                    <div class="badge bil-inline" x-text="section.badge"></div>
                                </div>
                                <div class="card-b">
                                    <div class="card-content">
                                        <h3 class="card-h bil-spread"><span x-text="item.nameENSpec"></span><span x-text="item.nameARSpec"></span></h3>
                                        <div class="bil-row card-p-row">
                                            <p class="en card-p" x-text="item.descEn || productType.descEn"></p>
                                            <p class="ar card-p" x-text="item.descAr || productType.descAr"></p>
                                        </div>
                                    </div>
                                    <div class="card-foot">
                                        <div class="price bil-row">
                                            <span class="en"><strong x-text="fmtPrice(item.priceEGP)"></strong></span>
                                            <span class="ar"><strong x-text="fmtPrice(item.priceEGP)"></strong></span>
                                        </div>
                                        <div class="card-act">
                                            <template x-if="section.key === 'udheya'">
                                                <div>
                                                    <button type="button" @click="openUdheyaConfiguration(item, false)" class="btn bac btn-sm bil-inline" :disabled="!item.isActive || item.stock <= 0">
                                                        <span class="en">Configure & Add</span><span class="ar">ุฎุตุต ูุฃุถู</span>
                                                    </button>
                                                    <button type="button" @click="openUdheyaConfiguration(item, true)" class="btn bp btn-sm bil-inline" :disabled="!item.isActive || item.stock <= 0">
                                                        <span class="en">Buy Now</span><span class="ar">ุงุดุชุฑ ุงูุขู</span>
                                                    </button>
                                                </div>
                                            </template>
                                            <template x-if="section.key !== 'udheya'">
                                                <div>
                                                    <button type="button" @click="addItemToCart(item)" class="btn bac btn-sm bil-inline" :disabled="!item.isActive || item.stock <= 0">
                                                        <span class="en">Add to Cart</span><span class="ar">ุฃุถู ููุณูุฉ</span>
                                                    </button>
                                                    <button type="button" @click="buyNow(item)" class="btn bp btn-sm bil-inline" :disabled="!item.isActive || item.stock <= 0">
                                                        <span class="en">Buy Now</span><span class="ar">ุงุดุชุฑ ุงูุขู</span>
                                                    </button>
                                                </div>
                                            </template>
                                            <span class="stock-display bil-inline" :class="{'out-of-stock': !item.isActive || item.stock <= 0}">
                                                <span class="en" x-text="getStockDisplayInfo(item.stock, item.isActive, 'en')"></span>
                                                <span class="ar" x-text="getStockDisplayInfo(item.stock, item.isActive, 'ar')"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </template>
                </div>
                <div class="empty-state tc" x-show="(!section.products || section.products.length === 0) && !load.init">
                    <p class="bil-row">
                        <span class="en">Products are currently being updated. Please check back soon!</span>
                        <span class="ar">ูุชู ุชุญุฏูุซ ุงูููุชุฌุงุช ุญุงูููุง. ูุฑุฌู ุงูุชุญูู ูุฑุฉ ุฃุฎุฑู ูุฑูุจูุง!</span>
                    </p>
                    <button @click="navigateToOrScroll('home')" class="btn bp btn-sm bil-inline">
                        <span class="en">Back to Home</span><span class="ar">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</span>
                    </button>
                </div>
                <p class="f-note bil-row tc" x-show="addedToCartMsg.text && addedToCartMsg.pageContext === section.key" :class="addedToCartMsg.isError ? 'err-msg' : 'succ-msg'">
                    <span class="en" x-text="addedToCartMsg.text ? (addedToCartMsg.text.en || addedToCartMsg.text) : ''"></span>
                    <span class="ar" x-text="addedToCartMsg.text ? (addedToCartMsg.text.ar || addedToCartMsg.text) : ''"></span>
                </p>
            </div>
        </section>
    </template>

    <!-- Checkout Section -->
    <section class="sec main-page-sec" x-show="currentPage === 'checkout'" x-transition>
        <div class="c">
            <div class="sec-head">
                <h1 class="bil-spread" x-ref="checkoutTitle" tabindex="-1">
                    <span class="en">Checkout</span><span class="ar">ุฅุชูุงู ุงูุทูุจ</span>
                </h1>
            </div>
            <div x-show="cartItems.length === 0 && !orderConf.show" class="empty-state tc">
                <p class="bil-row"><span class="en">Your cart is empty. Please add items to proceed.</span><span class="ar">ุณูุชู ูุงุฑุบุฉ. ูุฑุฌู ุฅุถุงูุฉ ููุชุฌุงุช ูููุชุงุจุนุฉ.</span></p>
                <button @click="navigateToOrScroll('udheya')" class="btn bp">
                    <span class="en">Continue Shopping</span><span class="ar">ูุชุงุจุนุฉ ุงูุชุณูู</span>
                </button>
            </div>
            
            <div x-show="cartItems.length > 0 && !orderConf.show" class="checkout-layout">
                <div class="checkout-form-col">
                    <form @submit.prevent="processOrder()" novalidate>
                        <div class="card form-panel">
                            <div class="card-b">
                                <h2 class="form-subh bil-spread"><span class="en">Contact Information</span><span class="ar">ูุนูููุงุช ุงูุงุชุตุงู</span></h2>
                                <div class="fg">
                                    <label class="bil-spread lbl-req"><span class="en">Name *</span><span class="ar">ุงูุงุณู *</span></label>
                                    <input type="text" class="input" x-model="checkoutForm.customer_name" @input="clrErr('customer_name')">
                                    <div class="err-msg" x-show="errs.customer_name" x-text="errs.customer_name ? (currLang === 'ar' ? errs.customer_name.ar : errs.customer_name.en) : ''"></div>
                                </div>
                                <div class="fg">
                                    <label class="bil-spread lbl-req"><span class="en">Phone *</span><span class="ar">ุงููุงุชู *</span></label>
                                    <input type="tel" class="input" x-model="checkoutForm.customer_phone" @input="clrErr('customer_phone')">
                                    <div class="err-msg" x-show="errs.customer_phone" x-text="errs.customer_phone ? (currLang === 'ar' ? errs.customer_phone.ar : errs.customer_phone.en) : ''"></div>
                                </div>
                                <div class="fg">
                                    <label class="bil-spread lbl-req"><span class="en">Email *</span><span class="ar">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</span></label>
                                    <input type="email" class="input" x-model="checkoutForm.customer_email" @input="clrErr('customer_email')">
                                    <div class="err-msg" x-show="errs.customer_email" x-text="errs.customer_email ? (currLang === 'ar' ? errs.customer_email.ar : errs.customer_email.en) : ''"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-act tc page-act final-submit">
                             <label class="lbl-chk bil-inline">
                                <input type="checkbox" x-model="checkoutForm.terms_agreed" @change="clrErr('terms_agreed')">
                                <span class="en">I agree to the <button type="button" class="link-style" @click.prevent="openRefundModal()">Terms & Refund Policy</button> *</span>
                                <span class="ar">ุฃูุงูู ุนูู <button type="button" class="link-style" @click.prevent="openRefundModal()">ุงูุดุฑูุท ูุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ</button> *</span>
                            </label>
                            <button type="submit" class="btn bac btn-lg btn-block bil-inline" :disabled="load.checkout">
                                <span x-show="!load.checkout"><span class="en">Place Order & Pay</span><span class="ar">ุฅุฑุณุงู ุงูุทูุจ ูุงูุฏูุน</span></span>
                                <span x-show="load.checkout"><span class="en">Processing...</span><span class="ar">ุฌุงุฑู ุงููุนุงูุฌุฉ...</span></span>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="checkout-summary-col">
                    <div class="card form-panel sticky-summary">
                        <div class="card-b">
                            <h2 class="form-subh bil-spread"><span class="en">Order Summary</span><span class="ar">ููุฎุต ุงูุทูุจ</span></h2>
                            <div class="rev-sum checkout-rev-sum">
                                <template x-for="item in cartItems" :key="item.uniqueIdInCart">
                                    <div class="sum-item">
                                        <div class="sum-item-content bil-spread">
                                            <span class="en" x-text="item.nameENSpec + ' (ร' + item.quantity + ')'"></span>
                                            <span class="ar" x-text="item.nameARSpec + ' (ร' + item.quantity + ')'"></span>
                                        </div>
                                        <div class="sum-item-price" x-text="fmtPrice(getSubtotalForItem(item))"></div>
                                    </div>
                                </template>
                                <hr class="sum-hr">
                                <div class="sum-total">
                                    <div class="bil-spread">
                                        <span class="en"><strong>Total:</strong></span>
                                        <span class="ar"><strong>ุงููุฌููุน:</strong></span>
                                    </div>
                                    <div><strong x-text="fmtPrice(checkoutForm.final_total_egp)"></strong></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Confirmation -->
            <section class="sec conf-sect-wide" x-show="orderConf.show" x-transition>
                <div class="c tc">
                    <h2 class="bil-spread conf-h" x-ref="orderConfTitle" tabindex="-1">
                        <span class="en">Order Confirmed! JazakAllah Khairan.</span>
                        <span class="ar">ุชู ุชุฃููุฏ ุงูุทูุจ! ุฌุฒุงูู ุงููู ุฎูุฑูุง.</span>
                    </h2>
                    <div class="conf-msg">
                        <div class="bil-row conf-intro">
                            <p class="en">Thank you for choosing Sheep Land. Your order is being processed.</p>
                            <p class="ar">ูุดูุฑูู ุนูู ุงุฎุชูุงุฑ ุฃุฑุถ ุงูุฃุบูุงู. ุทูุจูู ููุฏ ุงููุนุงูุฌุฉ.</p>
                        </div>
                        <div class="card form-panel order-id-box">
                            <div class="card-b order-id-box-body">
                                <div class="bil-spread">
                                    <p class="en order-id-box-imp"><strong>Order ID:</strong></p>
                                    <p class="ar order-id-box-imp"><strong>ุฑูู ุงูุทูุจ:</strong></p>
                                </div>
                                <p class="order-id-disp" x-text="orderConf.orderID"></p>
                            </div>
                        </div>
                        <div class="pay-instr">
                            <h4 class="form-subh bil-spread">
                                <span class="en">Payment Instructions</span>
                                <span class="ar">ุชุนูููุงุช ุงูุฏูุน</span>
                            </h4>
                            <div x-html="orderConf.paymentInstructions"></div>
                        </div>
                    </div>
                    <div class="form-act tc page-act">
                        <button @click="navigateToOrScroll('home')" class="btn bp btn-lg bil-inline">
                            <span class="en">Back to Homepage</span><span class="ar">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</span>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </section>
    
    <!-- Auth Section -->
    <section class="sec main-page-sec" x-show="currentPage === 'auth'" x-transition>
        <div class="c">
            <div class="sec-head">
                <h1 class="bil-spread" tabindex="-1">
                    <span class="en" x-text="auth.view === 'login' ? 'Login' : 'Register'"></span>
                    <span class="ar" x-text="auth.view === 'login' ? 'ุชุณุฌูู ุงูุฏุฎูู' : 'ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ'"></span>
                </h1>
            </div>
            <div class="auth-form-container">
                <div class="card form-panel">
                    <div class="card-b">
                        <!-- Login Form -->
                        <form @submit.prevent="loginUser()" novalidate x-show="auth.view === 'login'">
                            <div class="fg">
                                <label class="bil-spread lbl-req"><span class="en">Email *</span><span class="ar">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</span></label>
                                <input type="email" class="input" x-model="auth.email">
                            </div>
                            <div class="fg">
                                <label class="bil-spread lbl-req"><span class="en">Password *</span><span class="ar">ูููุฉ ุงููุฑูุฑ *</span></label>
                                <input type="password" class="input" x-model="auth.password">
                            </div>
                            <div class="card-act">
                                <button type="submit" class="btn bp btn-block bil-inline" :disabled="load.auth">
                                    <span x-show="!load.auth"><span class="en">Login</span><span class="ar">ุฏุฎูู</span></span>
                                    <span x-show="load.auth"><span class="en">Logging in...</span><span class="ar">ุฌุงุฑู ุงูุฏุฎูู...</span></span>
                                </button>
                            </div>
                            <p class="auth-toggle-link bil-row">
                                <span class="en">Don't have an account?</span><span class="ar">ููุณ ูุฏูู ุญุณุงุจุ</span>
                                <button type="button" @click="auth.view = 'register'; clrAllErrs();" class="link-style bil-inline"><span class="en">Register here</span><span class="ar">ุณุฌู ููุง</span></button>
                            </p>
                        </form>

                        <!-- Register Form -->
                        <form @submit.prevent="registerUser()" novalidate x-show="auth.view === 'register'">
                            <div class="fg">
                                <label class="bil-spread lbl-req"><span class="en">Full Name *</span><span class="ar">ุงูุงุณู ุงููุงูู *</span></label>
                                <input type="text" class="input" x-model="auth.name">
                            </div>
                            <div class="fg">
                                <label class="bil-spread lbl-req"><span class="en">Email *</span><span class="ar">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</span></label>
                                <input type="email" class="input" x-model="auth.email">
                            </div>
                            <div class="fg">
                                <label class="bil-spread lbl-req"><span class="en">Password *</span><span class="ar">ูููุฉ ุงููุฑูุฑ *</span></label>
                                <input type="password" class="input" x-model="auth.password">
                            </div>
                            <div class="fg">
                                <label class="bil-spread lbl-req"><span class="en">Confirm Password *</span><span class="ar">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ *</span></label>
                                <input type="password" class="input" x-model="auth.passwordConfirm">
                            </div>
                            <div class="card-act">
                                <button type="submit" class="btn bp btn-block bil-inline" :disabled="load.auth">
                                    <span x-show="!load.auth"><span class="en">Register</span><span class="ar">ุชุณุฌูู</span></span>
                                    <span x-show="load.auth"><span class="en">Registering...</span><span class="ar">ุฌุงุฑู ุงูุชุณุฌูู...</span></span>
                                </button>
                            </div>
                            <p class="auth-toggle-link bil-row">
                                <span class="en">Already have an account?</span><span class="ar">ูุฏูู ุญุณุงุจ ุจุงููุนูุ</span>
                                <button type="button" @click="auth.view = 'login'; clrAllErrs();" class="link-style bil-inline"><span class="en">Login here</span><span class="ar">ุณุฌู ุงูุฏุฎูู ููุง</span></button>
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Account Section -->
    <section class="sec main-page-sec" x-show="currentPage === 'account'" x-transition>
        <div class="c">
            <div class="sec-head">
                <h1 class="bil-spread" tabindex="-1">
                    <span class="en">My Account</span><span class="ar">ุญุณุงุจู</span>
                </h1>
            </div>
            <div x-show="!currentUser" class="empty-state tc">
                <p class="bil-row">
                    <span class="en">Please <a href="#auth" @click.prevent="navigateToOrScroll('auth')" class="link-style">login or register</a> to view your account.</span>
                    <span class="ar">ูุฑุฌู <a href="#auth" @click.prevent="navigateToOrScroll('auth')" class="link-style">ุชุณุฌูู ุงูุฏุฎูู ุฃู ุฅูุดุงุก ุญุณุงุจ</a> ูุนุฑุถ ุญุณุงุจู.</span>
                </p>
            </div>
            <div x-show="currentUser">
                <div class="card form-panel">
                    <div class="card-b">
                        <h2 class="form-subh bil-spread"><span class="en">Account Information</span><span class="ar">ูุนูููุงุช ุงูุญุณุงุจ</span></h2>
                        <div class="sum-item bil-row"><span class="en"><strong>Email:</strong> <span x-text="currentUser?.email || 'N/A'"></span></span><span class="ar"><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> <span x-text="currentUser?.email || 'ุบูุฑ ูุชููุฑ'"></span></span></div>
                        <div class="sum-item bil-row"><span class="en"><strong>Name:</strong> <span x-text="currentUser?.name || 'Not set'"></span></span><span class="ar"><strong>ุงูุงุณู:</strong> <span x-text="currentUser?.name || 'ุบูุฑ ูุญุฏุฏ'"></span></span></div>
                        <button @click="logoutUser()" class="btn bp-alt"><span class="en">Logout</span><span class="ar">ุชุณุฌูู ุงูุฎุฑูุฌ</span></button>
                    </div>
                </div>
                <div class="card form-panel">
                    <div class="card-b">
                        <h2 class="form-subh bil-spread"><span class="en">Order History</span><span class="ar">ุณุฌู ุงูุทูุจุงุช</span></h2>
                        <div x-show="load.orders" class="load-text tc">Loading orders...</div>
                        <div x-show="!load.orders && userOrders.length === 0" class="empty-state tc">
                            <p class="bil-row"><span class="en">No orders yet.</span><span class="ar">ูุง ุชูุฌุฏ ุทูุจุงุช ุจุนุฏ.</span></p>
                            <button @click="navigateToOrScroll('udheya')" class="btn bp">
                                <span class="en">Start Shopping</span><span class="ar">ุงุจุฏุฃ ุงูุชุณูู</span>
                            </button>
                        </div>
                        <div x-show="!load.orders && userOrders.length > 0">
                            <template x-for="order in userOrders" :key="order.id">
                                <div class="card order-history-item">
                                    <div class="card-b">
                                        <div class="sum-item bil-row">
                                            <div><strong class="en">Order ID:</strong><strong class="ar">ุฑูู ุงูุทูุจ:</strong></div>
                                            <div><span x-text="order.order_id_text"></span></div>
                                        </div>
                                        <div class="sum-item bil-row">
                                            <div><strong class="en">Status:</strong><strong class="ar">ุงูุญุงูุฉ:</strong></div>
                                            <div><span class="stat-hl" x-text="order.order_status"></span></div>
                                        </div>
                                        <div class="sum-item bil-row">
                                             <div><strong class="en">Total:</strong><strong class="ar">ุงูุฅุฌูุงูู:</strong></div>
                                             <div><span x-text="fmtPrice(order.total_amount_due_egp)"></span></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Footer -->
<footer class="foot main-page-sec">
    <div class="c">
        <div class="foot-grid">
            <div class="bil-row foot-brand-desc">
                <p class="en">Your trusted partner for premium, Sharia-compliant livestock and meat, delivered with care and tradition.</p>
                <p class="ar">ุดุฑููู ุงูููุซูู ููููุงุดู ูุงููุญูู ุงููุงุฎุฑุฉ ุงููุชูุงููุฉ ูุน ุงูุดุฑูุนุฉุ ููุตููุง ุจุนูุงูุฉ ูุฃุตุงูุฉ.</p>
            </div>
        </div>
        <hr class="foot-div">
        <p class="foot-copy">ยฉ <span x-text="new Date().getFullYear()"></span> Sheep Land.
            <span class="bil-copy">
                <span class="en">All rights reserved.</span><span class="ar">ุฌููุน ุงูุญููู ูุญููุธุฉ.</span>
            </span>
             | <button @click.prevent="openRefundModal()" class="footer-link-btn bil-inline"><span class="en">Refund Policy</span><span class="ar">ุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ</span></button>
        </p>
    </div>
</footer>

<script src="vendor/pocketbase.umd.js"></script>
<script defer src="vendor/alpine.min.js"></script>
<script defer src="vendor/alpine-collapse.min.js"></script>
<script src="main.js"></script>

</body>
</html>
