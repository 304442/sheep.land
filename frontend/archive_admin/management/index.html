<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>نظام إدارة مزرعة الأغنام</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/pocketbase.umd.js"></script> 
</head>
<body>
    <div class="app-container" id="app-container-sfms">
        <div class="pull-to-refresh" id="pagePullToRefresh">
            <div class="ptr-content">
                <span class="ptr-icon">↓</span>
                <span class="ptr-text">اسحب للتحديث</span>
            </div>
        </div>
        <div class="app-header">
            <div class="header-content">
                <button class="header-btn hamburger-btn" onclick="toggleAppDrawer()" title="القائمة الرئيسية">☰</button>
                <h1 class="app-title" id="sfmFarmNameTitle">🐑 نظام إدارة مزرعة الأغنام</h1>
                <div class="header-actions">
                    <button class="header-btn" id="sfmsSyncBtn" onclick="syncSfmData()" title="مزامنة البيانات">🔄</button>
                    <button class="header-btn" id="sfmsSettingsBtn" onclick="showSfmSection('settings')" title="الإعدادات">⚙️</button>
                </div>
            </div>
        </div>

        <div class="content-area" id="sfmsContentArea">
            <div class="swipe-indicator swipe-left" id="navSwipeLeft">←</div>
            <div class="swipe-indicator swipe-right" id="navSwipeRight">→</div>
            <div class="section-page active" id="dashboard">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">📊</span> لوحة التحكم الرئيسية</h2></div>
                    <div class="stats-grid-dynamic" id="dashboardStats">
                        <div class="stat-card"><div class="stat-value" id="dashTotalAnimals">0</div><div class="stat-label">إجمالي الحيوانات</div></div>
                        <div class="stat-card"><div class="stat-value" id="dashEwesCount">0</div><div class="stat-label">النعاج</div></div>
                        <div class="stat-card"><div class="stat-value" id="dashRamsCount">0</div><div class="stat-label">الكباش</div></div>
                        <div class="stat-card"><div class="stat-value" id="dashLambsCount">0</div><div class="stat-label">الحملان</div></div>
                        <div class="stat-card alert-card" id="dashHealthAlertsCard"><div class="stat-value" id="dashHealthAlerts">0</div><div class="stat-label">تنبيهات صحية</div></div>
                        <div class="stat-card alert-card" id="dashFeedStockLowCard"><div class="stat-value" id="dashFeedStockLow">0</div><div class="stat-label">نقص مخزون علف</div></div>
                        <div class="stat-card"><div class="stat-value" id="dashUpcomingLambings">0</div><div class="stat-label">ولادات متوقعة</div></div>
                        <div class="stat-card"><div class="stat-value" id="dashAvgDailyGain">0 كجم</div><div class="stat-label">متوسط النمو اليومي</div></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">🔔</span> تنبيهات ومهام قادمة</h2><button class="btn btn-sm btn-secondary" onclick="showSfmSection('taskManagement')">عرض الكل</button></div>
                    <ul class="task-list" id="dashboardTasks"></ul>
                    <p id="noDashboardTasksMessage" class="list-empty-message hidden">لا توجد مهام أو تنبيهات عاجلة.</p>
                </div>
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">📈</span> مؤشرات أداء سريعة</h2></div>
                    <div class="chart-container chart-container-md"><canvas id="dashboardPerformanceChart"></canvas></div>
                    <div class="chart-container chart-container-md mt-20"><canvas id="dashboardBreedingChart"></canvas></div>
                </div>
            </div>

            <div class="section-page" id="animalManagement">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><span class="card-icon">🐏</span> إدارة القطيع</h2>
                        <button class="btn btn-primary btn-sm" onclick="openAnimalFormModal(null)">إضافة حيوان</button>
                    </div>
                    <div class="input-field">
                        <input type="text" class="form-control" id="animalSearchInput" oninput="filterAnimalList()" placeholder="بحث بالرقم، الاسم، السلالة...">
                    </div>
                    <div class="input-grid-4 mb-10">
                        <div class="input-field-sm"><label for="animalFilterBreed" class="input-label-sm">السلالة:</label><select class="form-control" id="animalFilterBreed" onchange="filterAnimalList()"><option value="">الكل</option></select></div>
                        <div class="input-field-sm"><label for="animalFilterSex" class="input-label-sm">الجنس:</label><select class="form-control" id="animalFilterSex" onchange="filterAnimalList()"><option value="">الكل</option><option value="male">ذكر</option><option value="female">أنثى</option></select></div>
                        <div class="input-field-sm"><label for="animalFilterStatus" class="input-label-sm">الحالة:</label><select class="form-control" id="animalFilterStatus" onchange="filterAnimalList()"><option value="">الكل</option></select></div>
                        <div class="input-field-sm"><label for="animalSortBy" class="input-label-sm">ترتيب حسب:</label><select class="form-control" id="animalSortBy" onchange="sortAndRenderAnimalList()"><option value="tagId">الرقم التعريفي</option><option value="birthDate">تاريخ الميلاد</option><option value="breed">السلالة</option></select></div>
                    </div>
                    <div class="batch-actions-bar hidden mb-10" id="animalBatchActionsBar">
                        <button class="btn btn-sm btn-secondary" onclick="handleAnimalBatchAction('vaccinate')">تحصين جماعي</button>
                        <button class="btn btn-sm btn-secondary" onclick="handleAnimalBatchAction('treat')">علاج جماعي</button>
                        <button class="btn btn-sm btn-secondary" onclick="handleAnimalBatchAction('moveGroup')">نقل مجموعة</button>
                        <button class="btn btn-sm btn-warning" onclick="handleAnimalBatchAction('sellGroup')">بيع مجموعة</button>
                    </div>
                    <div class="table-responsive-container">
                        <table class="data-table" id="animalListTable">
                            <thead><tr><th><input type="checkbox" id="selectAllAnimalsCheckbox" onchange="toggleSelectAllAnimals(this.checked)"></th><th>الرقم</th><th>صورة</th><th>السلالة</th><th>الجنس</th><th>العمر</th><th>الحالة</th><th>إجراءات</th></tr></thead>
                            <tbody id="animalListTableBody"></tbody>
                        </table>
                    </div>
                    <p id="noAnimalsMessage" class="list-empty-message hidden">لا توجد حيوانات مسجلة.</p>
                </div>
            </div>

            <div class="section-page" id="breedingManagement">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">⚭</span> سجلات التزاوج</h2><button class="btn btn-primary btn-sm" onclick="openMatingFormModal(null)">تسجيل تزاوج</button></div>
                    <div class="table-responsive-container">
                        <table class="data-table" id="matingRecordsTable">
                            <thead><tr><th>النعجة (ID)</th><th>الكبش (ID)</th><th>تاريخ التزاوج</th><th>ولادة متوقعة</th><th>الحالة</th><th>إجراءات</th></tr></thead>
                            <tbody id="matingRecordsTableBody"></tbody>
                        </table>
                    </div>
                     <p id="noMatingsMessage" class="list-empty-message hidden">لا توجد سجلات تزاوج.</p>
                </div>
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">🍼</span> سجلات الولادة</h2><button class="btn btn-primary btn-sm" onclick="openLambingFormModal(null)">تسجيل ولادة</button></div>
                     <div class="table-responsive-container">
                        <table class="data-table" id="lambingRecordsTable">
                            <thead><tr><th>الأم (ID)</th><th>تاريخ الولادة</th><th>عدد المواليد</th><th>مواليد (IDs)</th><th>ملاحظات</th><th>إجراءات</th></tr></thead>
                            <tbody id="lambingRecordsTableBody"></tbody>
                        </table>
                    </div>
                    <p id="noLambingsMessage" class="list-empty-message hidden">لا توجد سجلات ولادة.</p>
                </div>
                 <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">🌿</span> سجلات الفطام</h2><button class="btn btn-primary btn-sm" onclick="openWeaningFormModal(null)">تسجيل فطام</button></div>
                     <div class="table-responsive-container">
                        <table class="data-table" id="weaningRecordsTable">
                            <thead><tr><th>المولود (ID)</th><th>تاريخ الفطام</th><th>وزن الفطام (كجم)</th><th>ملاحظات</th><th>إجراءات</th></tr></thead>
                            <tbody id="weaningRecordsTableBody"></tbody>
                        </table>
                    </div>
                    <p id="noWeaningsMessage" class="list-empty-message hidden">لا توجد سجلات فطام.</p>
                </div>
            </div>

            <div class="section-page" id="healthManagement">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">⚕️</span> السجل الصحي</h2><button class="btn btn-primary btn-sm" onclick="openHealthRecordFormModal(null)">إضافة سجل</button></div>
                    <div class="input-field"><input type="text" class="form-control" id="healthSearchInput" oninput="filterHealthRecords()" placeholder="بحث بالحيوان، التشخيص، الدواء..."></div>
                     <div class="table-responsive-container">
                        <table class="data-table" id="healthRecordsTable">
                            <thead><tr><th>الحيوان (ID)</th><th>التاريخ</th><th>النوع</th><th>التفاصيل</th><th>الدواء</th><th>فترة السحب</th><th>إجراءات</th></tr></thead>
                            <tbody id="healthRecordsTableBody"></tbody>
                        </table>
                    </div>
                     <p id="noHealthRecordsMessage" class="list-empty-message hidden">لا توجد سجلات صحية.</p>
                </div>
            </div>

            <div class="section-page" id="feedingManagement">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">🌾</span> إدارة التغذية والخلطات</h2> <button class="btn btn-primary btn-sm" onclick="openFeedRationFormModal(null)">خلطة جديدة</button></div>
                    <div class="input-field"><label class="input-label" for="feedRationSelect">اختر الخلطة/المجموعة:</label><select class="form-control" id="feedRationSelect" onchange="displaySelectedRation()"><option value="">-- اختر --</option></select></div>
                    <div id="feedRationDetailsDisplay" class="card feed-ration-details"></div>
                    <button class="btn btn-secondary" onclick="openFeedConsumptionLogModal()">تسجيل استهلاك علف</button>
                </div>
                 <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">💧</span> استهلاك المياه</h2></div>
                    <div class="input-field"><label class="input-label" for="waterConsumptionDate">التاريخ:</label><input type="date" class="form-control" id="waterConsumptionDate"></div>
                    <div class="input-field"><label class="input-label" for="waterConsumptionAmount">استهلاك المياه اليوم (لتر):</label><input type="number" class="form-control" id="waterConsumptionAmount" value="0" inputmode="numeric" min="0"></div>
                    <button class="btn btn-primary" onclick="logWaterConsumption()">تسجيل الاستهلاك</button>
                     <div id="waterLogDisplay" class="water-log-container"></div>
                </div>
            </div>
            
            <div class="section-page" id="inventoryManagement">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">📦</span> إدارة المخزون</h2><button class="btn btn-primary btn-sm" onclick="openInventoryItemFormModal(null)">إضافة عنصر</button></div>
                    <div class="input-field"><input type="text" class="form-control" id="inventorySearchInput" oninput="filterInventoryList()" placeholder="بحث باسم العنصر أو النوع..."></div>
                     <div class="input-field"><label for="inventoryFilterType" class="input-label-sm">فلترة بالنوع:</label><select class="form-control" id="inventoryFilterType" onchange="filterInventoryList()"><option value="">الكل</option><option value="feed">علف</option><option value="medication">دواء</option><option value="supply">مستلزمات</option><option value="product">منتج للبيع</option></select></div>
                    <div class="table-responsive-container">
                        <table class="data-table" id="inventoryTable">
                            <thead><tr><th>العنصر</th><th>النوع</th><th>الكمية</th><th>الوحدة</th><th>حد الطلب</th><th>إجراءات</th></tr></thead>
                            <tbody id="inventoryTableBody"></tbody>
                        </table>
                    </div>
                    <p id="noInventoryMessage" class="list-empty-message hidden">المخزون فارغ.</p>
                </div>
            </div>

             <div class="section-page" id="taskManagement">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">📅</span> إدارة المهام</h2><button class="btn btn-primary btn-sm" onclick="openTaskFormModal(null)">مهمة جديدة</button></div>
                    <div class="input-grid-3 mb-10">
                        <div class="input-field-sm"><label for="taskFilterStatus" class="input-label-sm">الحالة:</label><select class="form-control" id="taskFilterStatus" onchange="renderTaskList()"><option value="all">الكل</option><option value="pending">معلقة</option><option value="in_progress">قيد التنفيذ</option><option value="completed">مكتملة</option></select></div>
                        <div class="input-field-sm"><label for="taskFilterPriority" class="input-label-sm">الأولوية:</label><select class="form-control" id="taskFilterPriority" onchange="renderTaskList()"><option value="all">الكل</option><option value="high">عالية</option><option value="medium">متوسطة</option><option value="low">منخفضة</option></select></div>
                        <div class="input-field-sm"><label for="taskSortByDate" class="input-label-sm">الترتيب:</label><select class="form-control" id="taskSortByDate" onchange="renderTaskList()"><option value="dueDateAsc">تاريخ الاستحقاق (تصاعدي)</option><option value="dueDateDesc">تاريخ الاستحقاق (تنازلي)</option></select></div>
                    </div>
                    <div id="taskListContainer" class="task-list-container"></div>
                    <p id="noTasksToListMessage" class="list-empty-message hidden">لا توجد مهام بهذه الفلاتر.</p>
                </div>
            </div>

            <div class="section-page" id="salesPurchases">
                 <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">💸</span> السجلات المالية</h2></div>
                     <div class="input-grid-3 mb-15">
                        <button class="btn btn-sm btn-success" onclick="openTransactionFormModal(null, 'sale')">تسجيل بيع</button>
                        <button class="btn btn-sm btn-warning" onclick="openTransactionFormModal(null, 'purchase')">تسجيل شراء</button>
                        <button class="btn btn-sm btn-danger" onclick="openTransactionFormModal(null, 'expense')">تسجيل مصروف</button>
                     </div>
                     <div class="input-field"><label class="input-label" for="transactionFilterType">عرض حسب النوع:</label><select class="form-control" id="transactionFilterType" onchange="renderTransactionList()"><option value="all">الكل</option><option value="sale">مبيعات</option><option value="purchase">مشتريات</option><option value="expense">مصروفات أخرى</option></select></div>
                    <div class="table-responsive-container">
                        <table class="data-table" id="transactionsTable">
                             <thead><tr><th>التاريخ</th><th>النوع</th><th>الوصف</th><th>المبلغ</th><th>الطرف الآخر</th><th>إجراءات</th></tr></thead>
                            <tbody id="transactionsTableBody"></tbody>
                        </table>
                    </div>
                    <p id="noTransactionsMessage" class="list-empty-message hidden">لا توجد معاملات مسجلة.</p>
                </div>
            </div>

            <div class="section-page" id="reports">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">📄</span> التقارير التحليلية</h2></div>
                    <div class="input-grid-3">
                        <button class="btn btn-secondary" onclick="generateSfmReport('flockSummary')">ملخص القطيع</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('breedingPerformance')">أداء التناسل</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('healthSummary')">ملخص السجل الصحي</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('feedConsumption')">استهلاك الأعلاف</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('financialActuals')">الماليات الفعلية</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('inventoryStatus')">حالة المخزون</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('mortalityReport')">تقرير النفوق</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('cullingReport')">تقرير الاستبعاد</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('growthPerformance')">أداء النمو</button>
                        <button class="btn btn-secondary" onclick="generateSfmReport('equipmentMaintenance')">صيانة المعدات</button>
                    </div>
                    <div id="reportOutputArea" class="card report-output">
                        <p class="list-empty-message empty-state-text">اختر تقريراً لعرضه.</p>
                    </div>
                </div>
            </div>
            
            <div class="section-page" id="settings">
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">⚙️</span> الإعدادات العامة</h2></div>
                    <div class="input-field">
                        <label class="input-label" for="farmNameSetting">اسم المزرعة:</label>
                        <input type="text" class="form-control" id="farmNameSetting" placeholder="ادخل اسم المزرعة">
                    </div>
                    <div class="input-field">
                        <label class="input-label" for="farmOwnerSetting">اسم المالك:</label>
                        <input type="text" class="form-control" id="farmOwnerSetting" placeholder="ادخل اسم المالك">
                    </div>
                    <div class="input-field">
                        <label class="input-label" for="defaultCurrencySetting">العملة الافتراضية:</label>
                        <input type="text" class="form-control" id="defaultCurrencySetting" value="ج.م" placeholder="ج.م">
                    </div>
                    <div class="input-field">
                        <label class="input-label" for="photoUploadMaxSizeMBSetting">الحد الأقصى لحجم الصورة (MB):</label>
                        <input type="number" class="form-control" id="photoUploadMaxSizeMBSetting" value="2" min="1" max="10">
                    </div>
                    <div class="input-field">
                        <label class="input-label" for="lowStockWarningPercentageSetting">تنبيه نقص المخزون (% من حد الطلب):</label>
                        <input type="number" class="form-control" id="lowStockWarningPercentageSetting" value="20" min="0" max="100">
                    </div>
                    <button class="btn btn-primary" onclick="saveFarmSettings()">حفظ الإعدادات</button>
                </div>
                 <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">🧬</span> تخصيص السلالات وأنواع الأعلاف</h2></div>
                    <div class="input-field">
                        <label class="input-label" for="customBreedsSetting">السلالات (مفصولة بفاصلة):</label>
                        <textarea class="form-control" id="customBreedsSetting" placeholder="بلدي, رحماني, برقي..." rows="2"></textarea>
                    </div>
                    <div class="input-field">
                        <label class="input-label" for="customFeedTypesSetting">أنواع الأعلاف (مفصولة بفاصلة):</label>
                        <textarea class="form-control" id="customFeedTypesSetting" placeholder="علف تسمين, علف حلاب..." rows="2"></textarea>
                    </div>
                     <button class="btn btn-secondary" onclick="saveCustomTypes()">حفظ الأنواع المخصصة</button>
                </div>
                 <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">🛠️</span> إدارة المعدات</h2><button class="btn btn-primary btn-sm" onclick="openEquipmentFormModal(null)">إضافة معدة</button></div>
                    <div class="table-responsive-container">
                        <table class="data-table" id="equipmentListTable">
                            <thead><tr><th>اسم المعدة</th><th>تاريخ الشراء</th><th>التكلفة</th><th>آخر صيانة</th><th>إجراءات</th></tr></thead>
                            <tbody id="equipmentListTableBody"></tbody>
                        </table>
                    </div>
                    <p id="noEquipmentMessage" class="list-empty-message hidden">لا توجد معدات مسجلة.</p>
                 </div>
                 <div class="card">
                    <div class="card-header"><h2 class="card-title"><span class="card-icon">💾</span> إدارة البيانات</h2></div>
                    <div class="data-actions-grid">
                        <div class="data-action-card" onclick="backupSfmData()">
                            <div class="data-action-icon icon-gradient-green">
                                <span>💾</span>
                            </div>
                            <div class="data-action-content">
                                <div class="data-action-title">نسخ احتياطي</div>
                                <div class="data-action-desc">حفظ بيانات المزرعة</div>
                            </div>
                        </div>
                        <div class="data-action-card" onclick="document.getElementById('restoreSfmDataFile').click()">
                            <div class="data-action-icon icon-gradient-blue">
                                <span>📂</span>
                            </div>
                            <div class="data-action-content">
                                <div class="data-action-title">استعادة بيانات</div>
                                <div class="data-action-desc">من ملف احتياطي</div>
                            </div>
                        </div>
                        <div class="data-action-card danger" onclick="confirmClearAllData()">
                            <div class="data-action-icon icon-gradient-red">
                                <span>🗑️</span>
                            </div>
                            <div class="data-action-content">
                                <div class="data-action-title">مسح البيانات</div>
                                <div class="data-action-desc">حذف جميع البيانات</div>
                            </div>
                        </div>
                    </div>
                    <input type="file" id="restoreSfmDataFile" class="hidden" onchange="restoreSfmData(event)" accept=".json">
                </div>
            </div>
        </div>

        <div class="bottom-nav" id="sfmsBottomNav">
            <div class="nav-item active" onclick="showSfmSection('dashboard')"><span class="nav-icon">📊</span><span class="nav-label">الرئيسية</span></div>
            <div class="nav-item" onclick="showSfmSection('animalManagement')"><span class="nav-icon">🐏</span><span class="nav-label">الحيوانات</span></div>
            <div class="nav-item" onclick="showSfmSection('breedingManagement')"><span class="nav-icon">⚭</span><span class="nav-label">التناسل</span></div>
            <div class="nav-item" onclick="showSfmSection('healthManagement')"><span class="nav-icon">⚕️</span><span class="nav-label">الصحة</span></div>
            <div class="nav-item" id="sfmsMoreNavBtn" onclick="showSfmBottomSheet('sfmsMoreSheet')"><span class="nav-icon">⋯</span><span class="nav-label">المزيد</span></div>
        </div>
        
        <button class="fab" id="sfmMainFab" onclick="toggleQuickActions(); console.log('FAB button clicked');">
            <span>➕</span>
        </button>
        
        <!-- Smart Quick Actions -->
        <div class="quick-actions-fab" id="quickActionsFab">
            <button class="quick-action-btn" onclick="backupSfmData()" title="نسخ احتياطي سريع">
                <span>💾</span>
                <span class="quick-action-label">نسخ احتياطي</span>
            </button>
            <button class="quick-action-btn" onclick="generateQuickReport()" title="تقرير سريع">
                <span>📊</span>
                <span class="quick-action-label">تقرير سريع</span>
            </button>
            <button class="quick-action-btn" onclick="quickAddAnimal()" title="إضافة حيوان سريع">
                <span>🐑</span>
                <span class="quick-action-label">إضافة حيوان</span>
            </button>
        </div>

        
        <div class="bottom-sheet" id="sfmsMoreSheet">
            <div class="sheet-header"><h2 class="sheet-title">أقسام إضافية</h2><button class="sheet-close" onclick="hideSfmBottomSheet('sfmsMoreSheet')">✕</button></div>
            <div class="sheet-content">
                <div class="more-menu-grid">
                    <div class="more-menu-item" onclick="showSfmSection('feedingManagement'); hideSfmBottomSheet('sfmsMoreSheet');">
                        <div class="more-menu-icon" style="background: #f39c12;">🌾</div>
                        <div class="more-menu-label">التغذية</div>
                    </div>
                    <div class="more-menu-item" onclick="showSfmSection('inventoryManagement'); hideSfmBottomSheet('sfmsMoreSheet');">
                        <div class="more-menu-icon" style="background: #3498db;">📦</div>
                        <div class="more-menu-label">المخزون</div>
                    </div>
                    <div class="more-menu-item" onclick="showSfmSection('taskManagement'); hideSfmBottomSheet('sfmsMoreSheet');">
                        <div class="more-menu-icon" style="background: #e74c3c;">📅</div>
                        <div class="more-menu-label">المهام</div>
                    </div>
                    <div class="more-menu-item" onclick="showSfmSection('salesPurchases'); hideSfmBottomSheet('sfmsMoreSheet');">
                        <div class="more-menu-icon" style="background: #27ae60;">💸</div>
                        <div class="more-menu-label">المعاملات</div>
                    </div>
                    <div class="more-menu-item" onclick="showSfmSection('reports'); hideSfmBottomSheet('sfmsMoreSheet');">
                        <div class="more-menu-icon" style="background: #8e44ad;">📄</div>
                        <div class="more-menu-label">التقارير</div>
                    </div>
                    <div class="more-menu-item" onclick="showSfmSection('settings'); hideSfmBottomSheet('sfmsMoreSheet');">
                        <div class="more-menu-icon" style="background: #6c757d;">⚙️</div>
                        <div class="more-menu-label">الإعدادات</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- App Navigation Drawer -->
        <div class="app-drawer" id="appDrawer">
            <div class="drawer-header">
                <div class="drawer-logo">
                    <span class="drawer-logo-icon">🐑</span>
                    <span class="drawer-logo-text">Sheep.Land</span>
                </div>
                <button class="drawer-close" onclick="toggleAppDrawer()">✕</button>
            </div>
            <div class="drawer-content">
                <nav class="drawer-nav">
                    <a href="../index.html" class="drawer-nav-item">
                        <span class="drawer-nav-icon">🏠</span>
                        <span class="drawer-nav-label">الصفحة الرئيسية</span>
                        <span class="drawer-nav-arrow">←</span>
                    </a>
                    <a href="index.html" class="drawer-nav-item active">
                        <span class="drawer-nav-icon">🐑</span>
                        <span class="drawer-nav-label">إدارة المزرعة</span>
                        <span class="drawer-nav-badge">نشط</span>
                    </a>
                    <a href="../feasibility/index.html" class="drawer-nav-item">
                        <span class="drawer-nav-icon">📊</span>
                        <span class="drawer-nav-label">دراسة الجدوى</span>
                        <span class="drawer-nav-arrow">←</span>
                    </a>
                </nav>
                <div class="drawer-footer">
                    <div class="drawer-version">
                        <span>الإصدار 1.0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="app-drawer-overlay" id="appDrawerOverlay" onclick="toggleAppDrawer()"></div>
        <div class="overlay" id="sfmsPageOverlay" onclick="hideAllSfmSheets()"></div>

        <div class="modal-overlay" id="formModalOverlay">
            <div class="modal-content-sfms" id="formModalContainer">
                <div class="modal-header-sfms">
                    <h3 id="formModalTitle"></h3>
                    <button class="modal-close-btn-sfms" onclick="closeSfmFormModal()">✕</button>
                </div>
                <div class="modal-body-sfms" id="formModalBody">
                </div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    <!-- Enhanced Features -->
    <script src="pdf-export.js"></script>
    <script src="qr-scanner.js"></script>
    <script src="analytics-engine.js"></script>
    <!-- Business Integration -->
    <script src="farm-store-integration.js"></script>
    <script src="crm-system.js"></script>
    <script src="logistics-management.js"></script>
    <script src="butchery-management.js"></script>
    <script src="pocketbase-sync.js"></script>
</body>
</html>
