<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sheep Land - Udheya Booking V32</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Kufi+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <style>
        [x-cloak] { display: none !important; }
        .loading-text { padding: var(--s3) 0; text-align: center; color: var(--tm); }
        .disabled-btn { background-color: var(--tm) !important; border-color: var(--tm) !important; cursor: not-allowed !important; }
        .disabled-btn:hover { filter: none !important; transform: none !important; }
    </style>
</head>
<body x-data="udheyaBooking" x-init="initApp()" x-cloak>

<header class="site-header">
    <div class="c nav-container">
        <a href="/" class="brand-logo" @click.prevent="scrollToSection('body')">
            <span class="en">Sheep Land</span><span class="ar" dir="rtl">أرض الأغنام</span>
        </a>
        <nav class="main-nav">
            <ul class="nav-list">
                <li><a href="#step1-livestock" class="nav-link" @click.prevent="handleNavClick('#step1-livestock')"><span class="en">Book Udheya</span><span class="ar">حجز الأضحية</span></a></li>
                <li><a href="#check-booking-status" class="nav-link" @click.prevent="handleNavClick('#check-booking-status')"><span class="en">Check Status</span><span class="ar">تحقق من الحالة</span></a></li>
                <li><a href="#step6-what-next" class="nav-link" @click.prevent="handleNavClick('#step6-what-next')"><span class="en">Our Process</span><span class="ar">عمليتنا</span></a></li>
            </ul>
        </nav>
        <div class="header-extras">
            <div class="currency-switcher">
                <label for="currency-select" class="sr-only">Select Currency</label>
                <select id="currency-select" name="currency" x-model="currentCurrency" :disabled="isLoading.settings">
                    <template x-if="isLoading.settings && Object.keys(appSettings.exchange_rates || {}).length <= 1">
                        <option value="">Loading...</option>
                    </template>
                    <template x-for="code in Object.keys(appSettings.exchange_rates || {EGP: {rate_from_egp:1, symbol:'LE'}})" :key="code">
                        <option :value="code" x-text="code"></option>
                    </template>
                </select>
            </div>
            <div class="whatsapp-contact">
                <a href="https://wa.me/201234567890" target="_blank" rel="noopener noreferrer" title="Chat on WhatsApp">
                    <svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.35 3.43 16.84L2.05 22L7.31 20.61C8.75 21.36 10.36 21.79 12.04 21.79C17.5 21.79 21.95 17.34 21.95 11.88C21.95 6.42 17.5 2 12.04 2ZM12.04 20.13C10.56 20.13 9.13 19.75 7.89 19.05L7.55 18.85L4.41 19.65L5.23 16.61L5.02 16.26C4.24 14.93 3.79 13.45 3.79 11.91C3.79 7.36 7.51 3.64 12.04 3.64C16.57 3.64 20.29 7.36 20.29 11.88C20.29 16.4 16.57 20.13 12.04 20.13ZM17.36 14.45C17.11 14.32 15.81 13.67 15.58 13.58C15.35 13.5 15.18 13.46 15.01 13.71C14.84 13.97 14.32 14.58 14.15 14.75C13.98 14.92 13.81 14.94 13.56 14.82C13.31 14.69 12.45 14.39 11.41 13.47C10.61 12.78 10.08 11.94 9.91 11.68C9.73 11.42 9.86 11.28 9.99 11.15C10.1 11.04 10.24 10.85 10.38 10.68C10.52 10.52 10.57 10.41 10.7 10.16C10.83 9.91 10.78 9.73 10.7 9.61C10.62 9.48 10.06 8.09 9.83 7.54C9.6 6.99 9.38 7.04 9.21 7.03C9.06 7.02 8.9 7.02 8.73 7.02C8.57 7.02 8.31 7.07 8.09 7.32C7.87 7.57 7.36 8.04 7.36 9.24C7.36 10.44 8.11 11.59 8.24 11.76C8.37 11.94 9.84 14.22 12.11 15.14C12.71 15.39 13.14 15.52 13.47 15.63C13.99 15.78 14.41 15.75 14.74 15.7C15.12 15.63 15.81 15.19 16.01 14.87C16.21 14.54 16.21 14.27 16.16 14.15C16.11 14.02 15.96 13.95 15.75 13.84C15.55 13.73 17.61 14.58 17.36 14.45Z"/></svg>
                    <span class="whatsapp-number" x-text="appSettings.whatsapp_number || '+20 123 456 7890'"></span>
                </a>
            </div>
        </div>
    </div>
</header>

<section class="hero-section sec">
    <div class="c tc">
        <div class="bil-row hero-title-row"><h1 class="en">Book Your Udhiya Online</h1><h1 class="ar" dir="rtl">احجز أضحيتك عبر الإنترنت</h1></div>
        <div class="bil-row hero-subtitle-row"><h2 class="en">Farm to Your Table</h2><h2 class="ar" dir="rtl">من المزرعة إلى مائدتك</h2></div>
        <div class="bil-row hero-desc-row" style="max-width: 750px; margin-left: auto; margin-right: auto; margin-top: var(--s2);">
            <p class="en">Select your preferred livestock and customize your Qurbani with our straightforward options. We ensure a Sharia-compliant, and transparent service.</p>
            <p class="ar" dir="rtl">اختر ماشيتك المفضلة وخصص أضحيتك بخياراتنا الواضحة. نضمن لك خدمة متوافقة مع الشريعة، وشفافة.</p>
        </div>
    </div>
</section>

<section class="promo promo-sec" id="promo-banner">
    <div class="c">
        <div class="pban">
            <div class="bil-row">
                <div class="en"><h3 class="prm-h">Eid Al-Adha Offer! <strong x-text="appSettings.promo_days_left || 45"></strong> days left. Book early & get <span x-text="(appSettings.promo_discount_percent || 15) + '% Discount!'"></span></h3></div>
                <div class="ar" dir="rtl"><h3 class="prm-h">عرض عيد الأضحى! متبقي <strong x-text="appSettings.promo_days_left || 45"></strong> يومًا. احجز مبكرًا واحصل على <span x-text="'خصم ' + (appSettings.promo_discount_percent || 15) + '%!'"></span></h3></div>
            </div>
            <a href="#step1-livestock" class="btn bac" @click.prevent="handleNavClick('#step1-livestock')"><span class="en">Start Udheya Booking</span><span class="ar">ابدأ حجز الأضحية</span></a>
        </div>
    </div>
</section>

<form id="final-udheya-booking-form" @submit.prevent="submitBooking()">
    <div x-show="!bookingConfirmed">
        <div class="c">
            <div class="stepper-container">
                <a href="#step1-livestock" class="stepper-item" :class="{'active': currentStep === 1, 'completed': isStepCompleted(1)}" @click.prevent="goToStep(1)"><span class="step-number">1</span><span class="step-label en">Animal</span><span class="step-label ar">الحيوان</span></a>
                <div class="stepper-connector"></div>
                <a href="#step2-prep-packaging" class="stepper-item" :class="{'active': currentStep === 2, 'completed': isStepCompleted(2)}" @click.prevent="goToStep(2)"><span class="step-number">2</span><span class="step-label en">Preparation</span><span class="step-label ar">التجهيز</span></a>
                <div class="stepper-connector"></div>
                <a href="#step3-logistics-personalization" class="stepper-item" :class="{'active': currentStep === 3, 'completed': isStepCompleted(3)}" @click.prevent="goToStep(3)"><span class="step-number">3</span><span class="step-label en">Logistics</span><span class="step-label ar">التفاصيل</span></a>
                <div class="stepper-connector"></div>
                <a href="#step4-review-pay" class="stepper-item" :class="{'active': currentStep === 4, 'completed': isStepCompleted(4)}" @click.prevent="goToStep(4)"><span class="step-number">4</span><span class="step-label en">Review</span><span class="step-label ar">المراجعة</span></a>
            </div>
        </div>

        <input type="hidden" name="animal_type" :value="selectedAnimal.type">
        <input type="hidden" name="animal_weight" :value="selectedAnimal.weight">
        <input type="hidden" name="animal_base_price" :value="selectedAnimal.basePriceEGP">
        <input type="hidden" name="preparation_style" :value="selectedPrepStyle.value">
        <input type="hidden" name="packaging_preference" :value="selectedPackaging.value">
        <textarea name="custom_preparation_details_hidden" style="display:none;" :value="customPrepDetails"></textarea>
        <input type="hidden" name="sacrifice_day_selected_value" :value="selectedSacrificeDay.value">
        <input type="hidden" name="selected_livestock_type_key_hidden" :value="selectedAnimal.value">


        <section id="step1-livestock" class="sec livestock-sec" x-show="currentStep === 1 && !bookingConfirmed" x-transition.opacity.duration.300ms>
            <div class="c">
                <div class="sec-head"><div class="bil-row"><h2 class="en">Step 1: Select Animal & Approximate Weight</h2><h2 class="ar">الخطوة الأولى: اختر الحيوان والوزن التقريبي</h2></div></div>
                <div class="bil-row" style="font-size: 0.9em; color: var(--tm); margin-top: calc(var(--s3) * -0.8); margin-bottom: var(--s2);"><p class="en">All animals are carefully selected to meet Sharia requirements for age and health, suitable for Udheya.</p><p class="ar" dir="rtl">يتم اختيار جميع الحيوانات بعناية لتلبية متطلبات الشريعة من حيث العمر والصحة، ومناسبة للأضحية.</p></div>
                <div x-show="isLoading.settings || isLoading.livestock" class="loading-text">Loading options...</div>
                <div class="product-grid grid2" x-show="livestockOptions.length > 0 && !isLoading.livestock && !isLoading.settings">
                    <template x-for="animal in livestockOptions" :key="animal.type_key">
                        <div :id="animal.type_key" class="card livestock-card" :class="{'livestock-card-selected': selectedAnimal.value === animal.type_key}" :data-sheep-type="animal.name_en" :data-sheep-value="animal.type_key">
                            <div class="card-img"><img :src="getPocketBaseFileUrl(animal, animal.image)" :alt="animal.name_en"><div class="badge"><span class="en" x-text="animal.badge_en"></span><span class="ar" dir="rtl" x-text="animal.badge_ar"></span></div></div>
                            <div class="card-b">
                                <div class="card-content"><div class="bil-row"><div class="en"><h3 class="card-h" x-text="animal.name_en"></h3><p class="card-p" x-text="animal.description_en"></p></div><div class="ar" dir="rtl"><h3 class="card-h" x-text="animal.name_ar"></h3><p class="card-p" x-text="animal.description_ar"></p></div></div></div>
                                <div class="card-foot">
                                    <div class="price bil-row"><span class="en">From <span x-text="getFormattedPrice(animal.weights_prices[0]?.price_egp || 0)"></span></span><span class="ar">يبدأ من <span x-text="getFormattedPrice(animal.weights_prices[0]?.price_egp || 0)"></span></span></div>
                                    <div class="card-act">
                                        <label :for="animal.type_key + '_weight_select_s1'" class="sr-only" x-text="'Select ' + animal.name_en + ' Weight'"></label>
                                        <select :id="animal.type_key + '_weight_select_s1'" :name="'animal_weight_' + animal.type_key" class="livestock-weight-select">
                                            <template x-for="wp in animal.weights_prices" :key="wp.weight_range">
                                                <option :value="wp.weight_range" :data-price="wp.price_egp" x-text="wp.weight_range + ' (' + getFormattedPrice(wp.price_egp) + ')' + (wp.is_active === false || (typeof wp.stock === 'number' && wp.stock <= 0) ? ' - Out of Stock' : (typeof wp.stock === 'number' ? ' - Stock: ' + wp.stock : ''))" :disabled="wp.is_active === false || (typeof wp.stock === 'number' && wp.stock <= 0)"></option>
                                            </template>
                                        </select>
                                        <a href="#step2-prep-packaging" class="btn bp livestock-select-btn" @click.prevent="selectAnimal($el.closest('.livestock-card'), animal)"
                                           :class="{'disabled-btn': isLivestockWeightOutOfStock($el.closest('.livestock-card').querySelector('.livestock-weight-select'), animal)}"
                                           :disabled="isLivestockWeightOutOfStock($el.closest('.livestock-card').querySelector('.livestock-weight-select'), animal)">
                                            <span class="en">Select</span><span class="ar">اختر</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                 <div x-show="!livestockOptions.length && !isLoading.livestock && !isLoading.settings && pb" class="loading-text">No livestock options available at the moment.</div>
            </div>
        </section>

        <section id="step2-prep-packaging" class="sec udheya-page-step seca" x-show="currentStep === 2 && !bookingConfirmed" x-transition.opacity.duration.300ms>
            <div class="c">
                <div class="sec-head"><div class="bil-row"><h2 class="en">Step 2: Choose Preparation & Packaging</h2><h2 class="ar">الخطوة الثانية: اختر التجهيز والتغليف</h2></div></div>
                <div class="step2-columns-container">
                     <div class="step2-column prep-column">
                        <h4 class="form-subhead bil-row" style="text-align: center; justify-content:center; margin-top: var(--s3); margin-bottom: var(--s2);"><span class="en">Choose Preparation Style</span><span class="ar">اختر طريقة التجهيز</span></h4>
                        <div class="product-grid grid4">
                            <template x-for="prep in hardcodedPrepStyleOptions" :key="prep.value_key">
                                <div class="card prep-style-card" :data-prep-value="prep.value_key" :class="{'selected': selectedPrepStyle.value === prep.value_key}" @click="selectPrepStyle($el.closest('.prep-style-card'), prep)">
                                    <div class="card-img"><img :src="prep.image_path" :alt="prep.name_en"></div>
                                    <div class="card-b">
                                        <div class="card-content"><div class="bil-row"><h4 class="en" x-text="prep.name_en"></h4><h4 class="ar" dir="rtl" x-text="prep.name_ar"></h4></div><div class="bil-row"><p class="card-p en" x-text="prep.description_en"></p><p class="card-p ar" dir="rtl" x-text="prep.description_ar"></p></div></div>
                                        <div class="card-foot prep-card-foot"><button type="button" class="btn bac btn-block select-prep-btn"><span class="en">Select Style</span><span class="ar">اختر</span></button></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                        <div class="fg" id="custom-prep-details-container" x-show="selectedPrepStyle.is_custom" x-transition style="max-width: 800px; margin: var(--s2) auto 0;">
                            <label for="custom_prep_details_s2" class="bil-row"><span class="en">Custom Preparation Details</span><span class="ar">تفاصيل التجهيز المخصص</span></label>
                            <textarea id="custom_prep_details_s2" name="custom_preparation_details" class="form-input-styled" x-model="customPrepDetails"></textarea>
                        </div>
                    </div>
                    <div class="step2-column package-column">
                        <h4 class="form-subhead bil-row" style="text-align: center; justify-content:center; margin-top: var(--s3); margin-bottom: var(--s2);"><span class="en">Choose Your Packaging</span><span class="ar">اختر طريقة التغليف</span></h4>
                        <div class="product-grid grid2">
                             <template x-for="pkg in hardcodedPackagingOptions" :key="pkg.value_key">
                                <div class="card packaging-card" :data-packaging-value="pkg.value_key" :data-price-addon="pkg.addon_price_egp || 0" :class="{'selected': selectedPackaging.value === pkg.value_key}" @click="selectPackaging($el.closest('.packaging-card'), pkg)">
                                    <div class="card-img"><img :src="pkg.image_path" :alt="pkg.name_en"></div>
                                    <div class="card-b">
                                        <div class="card-content"><div class="bil-row"><h4 class="en" x-text="pkg.name_en"></h4><h4 class="ar" dir="rtl" x-text="pkg.name_ar"></h4></div><div class="bil-row"><p class="card-p en" x-text="pkg.description_en"></p><p class="card-p ar" dir="rtl" x-text="pkg.description_ar"></p></div></div>
                                        <div class="card-foot prep-card-foot">
                                            <div x-show="pkg.addon_price_egp > 0">
                                                <div class="price-addon en">(Add <span x-text="getFormattedPrice(pkg.addon_price_egp)"></span>)</div>
                                                <div class="price-addon ar" dir="rtl">(إضافة <span x-text="getFormattedPrice(pkg.addon_price_egp)"></span>)</div>
                                            </div>
                                            <button type="button" class="btn bac btn-block select-packaging-btn"><span class="en">Select</span><span class="ar">اختر</span></button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class="form-action tc page-step-action" style="margin-top: var(--s3);">
                    <button type="button" @click="goToStep(3)" class="btn bac btn-lg" :disabled="!selectedPrepStyle.value || !selectedPackaging.value"><span class="en">Next: Logistics</span><span class="ar">التالي: التفاصيل</span></button>
                </div>
            </div>
        </section>

        <section id="step3-logistics-personalization" class="sec udheya-page-step" x-show="currentStep === 3 && !bookingConfirmed" x-transition.opacity.duration.300ms>
            <!-- ... (Step 3 content, including customerEmail input) ... -->
        </section>

        <section id="step4-review-pay" class="sec udheya-page-step seca" x-show="currentStep === 4 && !bookingConfirmed" x-transition.opacity.duration.300ms>
            <!-- ... (Step 4 content) ... -->
        </section>
    </div>

    <section id="step5-booking-confirmation" class="sec udheya-page-step" x-show="currentStep === 5 && bookingConfirmed" x-transition.opacity.duration.300ms>
        <!-- ... (Step 5 content) ... -->
    </section>

    <section id="check-booking-status" class="sec udheya-page-step seca">
        <!-- ... (Check Booking Status content) ... -->
    </section>

    <section id="step6-what-next" class="sec udheya-process-sec">
        <!-- ... (Step 6 content) ... -->
    </section>

    <script src="https://unpkg.com/pocketbase@0.21.1/dist/pocketbase.umd.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="/script.js"></script>
</body>
</html>